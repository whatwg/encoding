<!DOCTYPE html><html lang="en-US"><meta charset="utf-8">
<title>Encoding Standard</title>
<link href="//www.whatwg.org/style/specification" rel="stylesheet">
<link href="//resources.whatwg.org/logo-encoding.svg" rel="icon">

<div class="head">

<p><a class="logo" href="//www.whatwg.org/"><img alt="WHATWG" height="100" src="//resources.whatwg.org/logo-encoding.svg" width="100"></a></p>
<h1>Encoding</h1>
<h2 class="no-num no-toc" id="living-standard-â€”-last-updated-14-april-2014">Living Standard â€” Last Updated 14 April 2014</h2>

<dl>
 <dt>This Version:
 <dd><a href="http://encoding.spec.whatwg.org/">http://encoding.spec.whatwg.org/</a>

 <dt>Participate:
 <dd>Send feedback to <a href="mailto:www-international@w3.org?subject=Encoding:%20">www-international@w3.org</a>
 (<a href="http://lists.w3.org/Archives/Public/www-international/">archives</a>) or
 <a href="https://www.w3.org/Bugs/Public/enter_bug.cgi?product=WHATWG&amp;component=Encoding">file a bug</a>
 (<a href="https://www.w3.org/Bugs/Public/buglist.cgi?product=WHATWG&amp;component=Encoding&amp;resolution=---">open bugs</a>)
 <dd><a href="http://wiki.whatwg.org/wiki/IRC">IRC: #whatwg on Freenode</a>

 <dt>Version History:
 <dd><a href="https://github.com/whatwg/encoding/commits">https://github.com/whatwg/encoding/commits</a>
 <dd><a href="https://twitter.com/encodings">@encodings</a>

 <dt>Editors:
 <dd><a href="http://annevankesteren.nl/">Anne van Kesteren</a>
  &lt;<a href="mailto:annevk@annevk.nl">annevk@annevk.nl</a>&gt;

 <dd>Joshua Bell (Google)
</dl>

<script async="" src="//resources.whatwg.org/file-bug.js"></script>

<p class="copyright"><a href="http://creativecommons.org/publicdomain/zero/1.0/" rel="license">CC0 1.0 Universal</a>.
To the extent possible under law, the editor has waived all copyright and
related or neighboring rights to this work. In addition, as of
14 April 2014, the editor has made this specification available
under the
<a href="http://www.openwebfoundation.org/legal/the-owf-1-0-agreements/owfa-1-0" rel="license">Open Web Foundation Agreement Version 1.0</a>,
which is available at
http://www.openwebfoundation.org/legal/the-owf-1-0-agreements/owfa-1-0.

</div>



<h2 class="no-num no-toc" id="table-of-contents">Table of Contents</h2>


<!--begin-toc-->
<ol class="toc">
 <li><a href="#preface"><span class="secno">1 </span>Preface</a></li>
 <li><a href="#conformance"><span class="secno">2 </span>Conformance</a></li>
 <li><a href="#terminology"><span class="secno">3 </span>Terminology</a></li>
 <li><a href="#encodings"><span class="secno">4 </span>Encodings</a>
  <ol>
   <li><a href="#encoders-and-decoders"><span class="secno">4.1 </span>Encoders and decoders</a></li>
   <li><a href="#names-and-labels"><span class="secno">4.2 </span>Names and labels</a></ol></li>
 <li><a href="#indexes"><span class="secno">5 </span>Indexes</a></li>
 <li><a href="#specification-hooks"><span class="secno">6 </span>Specification hooks</a></li>
 <li><a href="#api"><span class="secno">7 </span>API</a>
  <ol>
   <li><a href="#interface-textdecoder"><span class="secno">7.1 </span>Interface <code title="">TextDecoder</code></a></li>
   <li><a href="#interface-textencoder"><span class="secno">7.2 </span>Interface <code title="">TextEncoder</code></a></ol></li>
 <li><a href="#the-encoding"><span class="secno">8 </span>The encoding</a>
  <ol>
   <li><a href="#utf-8"><span class="secno">8.1 </span>utf-8</a>
    <ol>
     <li><a href="#utf-8-decoder"><span class="secno">8.1.1 </span>utf-8 decoder</a></li>
     <li><a href="#utf-8-encoder"><span class="secno">8.1.2 </span>utf-8 encoder</a></ol></ol></li>
 <li><a href="#legacy-single-byte-encodings"><span class="secno">9 </span>Legacy single-byte encodings</a>
  <ol>
   <li><a href="#single-byte-decoder"><span class="secno">9.1 </span>single-byte decoder</a></li>
   <li><a href="#single-byte-encoder"><span class="secno">9.2 </span>single-byte encoder</a></ol></li>
 <li><a href="#legacy-multi-byte-chinese-(simplified)-encodings"><span class="secno">10 </span>Legacy multi-byte Chinese (simplified) encodings</a>
  <ol>
   <li><a href="#gb18030"><span class="secno">10.1 </span>gb18030</a>
    <ol>
     <li><a href="#gb18030-decoder"><span class="secno">10.1.1 </span>gb18030 decoder</a></li>
     <li><a href="#gb18030-encoder"><span class="secno">10.1.2 </span>gb18030 encoder</a></ol></li>
   <li><a href="#hz-gb-2312"><span class="secno">10.2 </span>hz-gb-2312</a>
    <ol>
     <li><a href="#hz-gb-2312-decoder"><span class="secno">10.2.1 </span>hz-gb-2312 decoder</a></li>
     <li><a href="#hz-gb-2312-encoder"><span class="secno">10.2.2 </span>hz-gb-2312 encoder</a></ol></ol></li>
 <li><a href="#legacy-multi-byte-chinese-(traditional)-encodings"><span class="secno">11 </span>Legacy multi-byte Chinese (traditional) encodings</a>
  <ol>
   <li><a href="#big5"><span class="secno">11.1 </span>big5</a>
    <ol>
     <li><a href="#big5-decoder"><span class="secno">11.1.1 </span>big5 decoder</a></li>
     <li><a href="#big5-encoder"><span class="secno">11.1.2 </span>big5 encoder</a></ol></ol></li>
 <li><a href="#legacy-multi-byte-japanese-encodings"><span class="secno">12 </span>Legacy multi-byte Japanese encodings</a>
  <ol>
   <li><a href="#euc-jp"><span class="secno">12.1 </span>euc-jp</a>
    <ol>
     <li><a href="#euc-jp-decoder"><span class="secno">12.1.1 </span>euc-jp decoder</a></li>
     <li><a href="#euc-jp-encoder"><span class="secno">12.1.2 </span>euc-jp encoder</a></ol></li>
   <li><a href="#iso-2022-jp"><span class="secno">12.2 </span>iso-2022-jp</a>
    <ol>
     <li><a href="#iso-2022-jp-decoder"><span class="secno">12.2.1 </span>iso-2022-jp decoder</a></li>
     <li><a href="#iso-2022-jp-encoder"><span class="secno">12.2.2 </span>iso-2022-jp encoder</a></ol></li>
   <li><a href="#shift_jis"><span class="secno">12.3 </span>shift_jis</a>
    <ol>
     <li><a href="#shift_jis-decoder"><span class="secno">12.3.1 </span>shift_jis decoder</a></li>
     <li><a href="#shift_jis-encoder"><span class="secno">12.3.2 </span>shift_jis encoder</a></ol></ol></li>
 <li><a href="#legacy-multi-byte-korean-encodings"><span class="secno">13 </span>Legacy multi-byte Korean encodings</a>
  <ol>
   <li><a href="#euc-kr"><span class="secno">13.1 </span>euc-kr</a>
    <ol>
     <li><a href="#euc-kr-decoder"><span class="secno">13.1.1 </span>euc-kr decoder</a></li>
     <li><a href="#euc-kr-encoder"><span class="secno">13.1.2 </span>euc-kr encoder</a></ol></ol></li>
 <li><a href="#legacy-miscellaneous-encodings"><span class="secno">14 </span>Legacy miscellaneous encodings</a>
  <ol>
   <li><a href="#replacement"><span class="secno">14.1 </span>replacement</a>
    <ol>
     <li><a href="#replacement-decoder"><span class="secno">14.1.1 </span>replacement decoder</a></li>
     <li><a href="#replacement-encoder"><span class="secno">14.1.2 </span>replacement encoder</a></ol></li>
   <li><a href="#common-infrastructure-for-utf-16be-and-utf-16le"><span class="secno">14.2 </span>Common infrastructure for <span>utf-16be</span> and <span>utf-16le</span></a>
    <ol>
     <li><a href="#shared-utf-16-decoder"><span class="secno">14.2.1 </span>shared utf-16 decoder</a></li>
     <li><a href="#shared-utf-16-encoder"><span class="secno">14.2.2 </span>shared utf-16 encoder</a></ol></li>
   <li><a href="#utf-16be"><span class="secno">14.3 </span>utf-16be</a>
    <ol>
     <li><a href="#utf-16be-decoder"><span class="secno">14.3.1 </span>utf-16be decoder</a></li>
     <li><a href="#utf-16be-encoder"><span class="secno">14.3.2 </span>utf-16be encoder</a></ol></li>
   <li><a href="#utf-16le"><span class="secno">14.4 </span>utf-16le</a>
    <ol>
     <li><a href="#utf-16le-decoder"><span class="secno">14.4.1 </span>utf-16le decoder</a></li>
     <li><a href="#utf-16le-encoder"><span class="secno">14.4.2 </span>utf-16le encoder</a></ol></li>
   <li><a href="#x-user-defined"><span class="secno">14.5 </span>x-user-defined</a>
    <ol>
     <li><a href="#x-user-defined-decoder"><span class="secno">14.5.1 </span>x-user-defined decoder</a></li>
     <li><a href="#x-user-defined-encoder"><span class="secno">14.5.2 </span>x-user-defined encoder</a></ol></ol></li>
 <li><a class="no-num" href="#references">References</a></li>
 <li><a class="no-num" href="#acknowledgments">Acknowledgments</a></ol>
<!--end-toc-->



<h2 id="preface"><span class="secno">1 </span>Preface</h2>

<p>While encodings have been defined to some extent, implementations have
not always implemented them in the same way, have not always used the same
labels, and often differ in dealing with undefined and former proprietary
areas of encodings. This specification attempts to fill those gaps so that
new implementations do not have to reverse engineer encoding implementations
of the market leaders and existing implementations can converge.

<p>In particular, this specification defines the encodings, their algorithms to go from
bytes to code points and back, and their canonical names and identifying labels. This
specification also defines an API to expose part of the encoding algorithms to JavaScript.

<p>Historically encodings and their specifications (if any) were kept track of by the
<a href="http://www.iana.org/assignments/character-sets/character-sets.xhtml">IANA Character Sets registry</a>.
This specification renders that registry obsolete.



<h2 id="conformance"><span class="secno">2 </span>Conformance</h2>

<p>All diagrams, examples, and notes in this specification are
non-normative, as are all sections explicitly marked non-normative.
Everything else in this specification is normative.

<p>The key words "MUST", "MUST NOT", "REQUIRED", <!--"SHALL", "SHALL
NOT",--> "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and
"OPTIONAL" in the normative parts of this document are to be
interpreted as described in RFC2119. For readability, these words do
not appear in all uppercase letters in this specification.
<a href="#refsRFC2119">[RFC2119]</a>

<p>Conformance requirements phrased as algorithms or specific steps
may be implemented in any manner, so long as the end result is
equivalent. (In particular, the algorithms defined in this
specification are intended to be easy to follow, and not intended to
be performant.)

<p id="hardwareLimitations">User agents may impose
implementation-specific limits on otherwise unconstrained inputs,
e.g. to prevent denial of service attacks, to guard against running
out of memory, or to work around platform-specific limitations.



<h2 id="terminology"><span class="secno">3 </span>Terminology</h2>

<p>Hexadecimal numbers are prefixed with "0x".

<p>In equations, all numbers are integers, addition is represented by "+",
subtraction by "âˆ’", multiplication by "Ã—", division by "/",
calculating the remainder of a division (also known as modulo) by "%",
arithmetic left shifts by "&lt;&lt;", arithmetic right shifts by "&gt;&gt;",
bitwise AND by "&amp;", and bitwise OR by "|".

<p>A <dfn id="byte">byte</dfn> is a sequence of eight bits, represented as a
double-digit hexadecimal number in the range 0x00 to 0xFF.

<p>A <dfn id="code-point">code point</dfn> is a Unicode code point and is represented as a
four-to-six digit hexadecimal number, typically prefixed with "U+".
In equations and <a href="#index" title="index">indexes</a> code points are prefixed
with "0x". <a href="#refsUNICODE">[UNICODE]</a>

<p>A <dfn id="scalar-value">scalar value</dfn> is a <a href="#code-point">code point</a> that is not in the range U+D800
to U+DFFF.

<p>The <dfn id="ascii-whitespace">ASCII whitespace</dfn> are code points U+0009, U+000A, U+000C,
U+000D, and U+0020.

<p>The <dfn id="ascii-digits">ASCII digits</dfn> are code points in the range U+0030 to U+0039.

<p>A <dfn id="string">string</dfn> is a sequence of code points.

<p>Comparing two strings in an <dfn id="ascii-case-insensitive">ASCII case-insensitive</dfn> manner
means comparing them exactly, code point for code point, except that the
characters in the range U+0041 to U+005A (i.e. LATIN CAPITAL LETTER A to
LATIN CAPITAL LETTER Z) and the corresponding characters in the range
U+0061 to U+007A (i.e. LATIN SMALL LETTER A to LATIN SMALL LETTER Z) are
considered to also match.

<hr>

<p>A <dfn id="concept-token" title="concept-token">token</dfn> is a piece of data, such as a <a href="#byte">byte</a>
or <a href="#code-point">code point</a>.

<p>A <dfn id="concept-stream" title="concept-stream">stream</dfn> represents an ordered sequence of
<a href="#concept-token" title="concept-token">tokens</a>. <dfn id="end-of-stream">End-of-stream</dfn> is a special
<a href="#concept-token" title="concept-token">token</a> that signifies no more
<a href="#concept-token" title="concept-token">tokens</a> are in the
<a href="#concept-stream" title="concept-stream">stream</a>.

<p>When a <a href="#concept-token" title="concept-token">token</a> is
<dfn id="concept-stream-read" title="concept-stream-read">read</dfn> from a <a href="#concept-stream" title="concept-stream">stream</a>,
the first token in the stream must be returned and subsequently removed, and
<a href="#end-of-stream">end-of-stream</a> must be returned otherwise.
<!-- this means read is blocking on e.g. networking activity;
     SimonSapin thinks this is fine, curse him if not -->

<p>When one or more <a href="#concept-token" title="concept-token">tokens</a> are
<dfn id="concept-stream-prepend" title="concept-stream-prepend">prepended</dfn> to a
<a href="#concept-stream" title="concept-stream">stream</a>, those tokens must be inserted, in given order,
before the first token in the stream.

<p class="example">Inserting the sequence of tokens <code title="">&amp;#128169;</code> in a
stream "<code title=""> hello world</code>", results in a stream
"<code title="">&amp;#128169; hello world</code>". The next token to be read would be
<code title="">&amp;</code>. <!-- ðŸ’© -->

<p>When one or more <a href="#concept-token" title="concept-token">tokens</a> are
<dfn id="concept-stream-push" title="concept-stream-push">pushed</dfn> to a <a href="#concept-stream" title="concept-stream">stream</a>,
those tokens must be inserted, in given order, after the last token in the stream.



<h2 id="encodings"><span class="secno">4 </span>Encodings</h2>

<p>An <dfn id="encoding">encoding</dfn> defines a mapping from a <a href="#scalar-value">scalar value</a> sequence to a
<a href="#byte">byte</a> sequence (and vice versa). Each <a href="#encoding">encoding</a> has a
<dfn id="name">name</dfn>, and one or more <dfn id="label" title="label">labels</dfn>.


<h3 id="encoders-and-decoders"><span class="secno">4.1 </span>Encoders and decoders</h3>

<p>Each <a href="#encoding">encoding</a> has an associated <dfn id="decoder">decoder</dfn> and <dfn id="encoder">encoder</dfn>.
Each <a href="#decoder">decoder</a> and <a href="#encoder">encoder</a> have a <dfn id="handler">handler</dfn> algorithm.
A <a href="#handler">handler</a> algorithm takes an input <a href="#concept-stream" title="concept-stream">stream</a>
and a <a href="#concept-token" title="concept-token">token</a>, and returns
<dfn id="finished">finished</dfn>,
one or more <a href="#concept-token" title="concept-token">tokens</a>,
<dfn id="error">error</dfn> optionally with a <a href="#code-point">code point</a>, or
<dfn id="continue">continue</dfn>.

<p>An <dfn id="error-mode">error mode</dfn> as used below is either <i title="">replacement</i> (default) or
<i>fatal</i> for a <a href="#decoder">decoder</a> and one of <i>fatal</i> (default) or <i>HTML</i>
for an <a href="#encoder">encoder</a>.

<p class="note">An XML processor would set <a href="#error-mode">error mode</a> to <i>fatal</i>.
<a class="informative" href="#refsXML">[XML]</a>

<p class="note"><i>HTML</i> exists as <a href="#error-mode">error mode</a> due to URLs and HTML forms
requiring a non-terminating legacy <a href="#encoder">encoder</a>. The <i>HTML</i>
<a href="#error-mode">error mode</a> causes a sequence to be emitted that cannot be distinguished from
legitimate input and can therefore lead to silent data loss. Developers are strongly
encouraged to use the <a href="#utf-8">utf-8</a> <a href="#encoding">encoding</a> to prevent this from
happening.
<a class="informative" href="#refsURL">[URL]</a>
<a class="informative" href="#refsHTML">[HTML]</a>

<p>To <dfn id="concept-encoding-run" title="concept-encoding-run">run</dfn> an <a href="#encoding">encoding</a>'s
<a href="#decoder">decoder</a> or <a href="#encoder">encoder</a> <var>encoderDecoder</var> with input
<a href="#concept-stream" title="concept-stream">stream</a> <var>input</var>, output
<a href="#concept-stream" title="concept-stream">stream</a> <var>output</var>, and <a href="#error-mode">error mode</a>
<var>mode</var>, run these steps:

<ol>
 <li><p>If <var>mode</var> is not given, set it to <i title="">replacement</i>, if
 <var>encoderDecoder</var> is a <a href="#decoder">decoder</a>, and <i>fatal</i> otherwise.

 <li><p>Let <var>encoderDecoderInstance</var> be a new <var>encoderDecoder</var>.

 <li>
  <p>While true:

  <ol>
   <li><p>Let <var>result</var> be the result of
   <a href="#concept-encoding-process" title="concept-encoding-process">processing</a> the result of
   <a href="#concept-stream-read" title="concept-stream-read">reading</a> from <var>input</var> for
   <var title="">encoderDecoderInstance</var>, <var>input</var>, <var>output</var>, and
   <var>mode</var>.

   <li><p>If <var>result</var> is not <a href="#continue">continue</a>, return <var>result</var>.

   <li><p>Otherwise, do nothing.
  </ol>
</ol>

<p>To <dfn id="concept-encoding-process" title="concept-encoding-process">process</dfn> a
<a href="#concept-token" title="concept-token">token</a> <var>token</var> for an <a href="#encoding">encoding</a>'s
<a href="#encoder">encoder</a> or <a href="#decoder">decoder</a> instance <var>encoderDecoderInstance</var>,
<a href="#concept-stream" title="concept-stream">stream</a> <var>input</var>, output
<a href="#concept-stream" title="concept-stream">stream</a> <var>output</var>, and
error mode <var>mode</var>, run these steps:

<ol>
 <li><p>If <var>mode</var> is not given, set it to <i title="">replacement</i>, if
 <var>encoderDecoder</var> is a <a href="#decoder">decoder</a> instance, and <i>fatal</i> otherwise.

 <li><p>Let <var>result</var> be the result of running <var>encoderDecoderInstance</var>'s
 <a href="#handler">handler</a> on <var>token</var>.

 <li><p>If <var>result</var> is <a href="#continue">continue</a> or <a href="#finished">finished</a>, return
 <var>result</var>.

 <li><p>Otherwise, if <var>result</var> is one or more
 <a href="#concept-token" title="concept-token">tokens</a>, <a href="#concept-stream-push" title="concept-stream-push">push</a>
 <var title="">result</var> to <var>output</var>.

 <li>
  <p>Otherwise, if <var>result</var> is <a href="#error">error</a>, switch on <var>mode</var> and
  run the associated steps:

  <dl class="switch">
   <dt><i title="">replacement</i>
   <dd><a href="#concept-stream-push" title="concept-stream-push">Push</a> U+FFFD to <var>output</var>.
   <dt><i>HTML</i>
   <dd><a href="#concept-stream-prepend" title="concept-stream-prepend">Prepend</a> U+0026, U+0023, followed by the
   shortest sequence of <a href="#ascii-digits">ASCII digits</a> representing <var title="">result</var>'s
   <a href="#code-point">code point</a> in base ten, followed by U+003B to <var>input</var>.
   <!-- &# ... ; -->
   <dt><i>fatal</i>
   <dd>Return <a href="#error">error</a>.
  </dl>

 <li>Return <a href="#continue">continue</a>.
</ol>


<h3 id="names-and-labels"><span class="secno">4.2 </span>Names and labels</h3>

<p>The table below lists all <a href="#encoding" title="encoding">encodings</a>
and their <a href="#label" title="label">labels</a> user agents must support.
User agents must not support any other <a href="#encoding" title="encoding">encodings</a>
or <a href="#label" title="label">labels</a>.

<p>Authors must use the <a href="#utf-8">utf-8</a> <a href="#encoding">encoding</a> and must use the
<a href="#ascii-case-insensitive">ASCII case-insensitive</a> "<code title="">utf-8</code>" <a href="#label">label</a> to
identify it.

<p>New protocols and formats, as well as existing formats deployed in new contexts, must
use the <a href="#utf-8">utf-8</a> <a href="#encoding">encoding</a> exclusively. If these protocols and
formats need to expose the <a href="#encoding">encoding</a>'s <a href="#name">name</a> or
<a href="#label">label</a>, they must expose it as "<code title="">utf-8</code>".

<p>To <dfn id="concept-encoding-get" title="concept-encoding-get">get an encoding</dfn> from a string
<var title="">label</var>, run these steps:

<ol>
 <li><p>Remove any leading and trailing <a href="#ascii-whitespace">ASCII whitespace</a> from
 <var title="">label</var>.

 <li><p>If <var title="">label</var> is an <a href="#ascii-case-insensitive">ASCII case-insensitive</a>
 match for any of the <a href="#label" title="label">labels</a> listed in the table
 below, return the corresponding <a href="#encoding">encoding</a>, and failure otherwise.
</ol>

<p class="note">In violation of
<a href="http://www.unicode.org/reports/tr22/tr22-7.html#Charset_Alias_Matching">section 1.4 of Unicode Technical Standard #22</a>
this is a much simpler and more restrictive matching algorithm, as that is
found to be necessary to be compatible with deployed content.

<table>
 <thead>
  <tr>
   <th><a href="#name">Name</a>
   <th><a href="#label" title="label">Labels</a>
 <tbody>
  <tr><th colspan="2"><a href="#the-encoding">The Encoding</a>
  <tr>
   <td rowspan="3"><a href="#utf-8">utf-8</a>
   <td>"<code title="">unicode-1-1-utf-8</code>"
  <tr><td>"<code title="">utf-8</code>"
  <tr><td>"<code title="">utf8</code>"
 <tbody>
  <tr><th colspan="2"><a href="#legacy-single-byte-encodings">Legacy single-byte encodings</a>
  <tr>
   <td rowspan="4"><a href="#ibm866">ibm866</a>
   <td>"<code title="">866</code>"
  <tr><td>"<code title="">cp866</code>"
  <tr><td>"<code title="">csibm866</code>"
  <tr><td>"<code title="">ibm866</code>"
  <tr>
   <td rowspan="9"><a href="#iso-8859-2">iso-8859-2</a>
   <td>"<code title="">csisolatin2</code>"
  <tr><td>"<code title="">iso-8859-2</code>"
  <tr><td>"<code title="">iso-ir-101</code>"
  <tr><td>"<code title="">iso8859-2</code>"
  <tr><td>"<code title="">iso88592</code>"
  <tr><td>"<code title="">iso_8859-2</code>"
  <tr><td>"<code title="">iso_8859-2:1987</code>"
  <tr><td>"<code title="">l2</code>"
  <tr><td>"<code title="">latin2</code>"
  <tr>
   <td rowspan="9"><a href="#iso-8859-3">iso-8859-3</a>
   <td>"<code title="">csisolatin3</code>"
  <tr><td>"<code title="">iso-8859-3</code>"
  <tr><td>"<code title="">iso-ir-109</code>"
  <tr><td>"<code title="">iso8859-3</code>"
  <tr><td>"<code title="">iso88593</code>"
  <tr><td>"<code title="">iso_8859-3</code>"
  <tr><td>"<code title="">iso_8859-3:1988</code>"
  <tr><td>"<code title="">l3</code>"
  <tr><td>"<code title="">latin3</code>"
  <tr>
   <td rowspan="9"><a href="#iso-8859-4">iso-8859-4</a>
   <td>"<code title="">csisolatin4</code>"
  <tr><td>"<code title="">iso-8859-4</code>"
  <tr><td>"<code title="">iso-ir-110</code>"
  <tr><td>"<code title="">iso8859-4</code>"
  <tr><td>"<code title="">iso88594</code>"
  <tr><td>"<code title="">iso_8859-4</code>"
  <tr><td>"<code title="">iso_8859-4:1988</code>"
  <tr><td>"<code title="">l4</code>"
  <tr><td>"<code title="">latin4</code>"
  <tr>
   <td rowspan="8"><a href="#iso-8859-5">iso-8859-5</a>
   <td>"<code title="">csisolatincyrillic</code>"
  <tr><td>"<code title="">cyrillic</code>"
  <tr><td>"<code title="">iso-8859-5</code>"
  <tr><td>"<code title="">iso-ir-144</code>"
  <tr><td>"<code title="">iso8859-5</code>"
  <tr><td>"<code title="">iso88595</code>"
  <tr><td>"<code title="">iso_8859-5</code>"
  <tr><td>"<code title="">iso_8859-5:1988</code>"
  <tr>
   <td rowspan="14"><a href="#iso-8859-6">iso-8859-6</a>
   <td>"<code title="">arabic</code>"
  <tr><td>"<code title="">asmo-708</code>"
  <tr><td>"<code title="">csiso88596e</code>"
  <tr><td>"<code title="">csiso88596i</code>"
  <tr><td>"<code title="">csisolatinarabic</code>"
  <tr><td>"<code title="">ecma-114</code>"
  <tr><td>"<code title="">iso-8859-6</code>"
  <tr><td>"<code title="">iso-8859-6-e</code>"
  <tr><td>"<code title="">iso-8859-6-i</code>"
  <tr><td>"<code title="">iso-ir-127</code>"
  <tr><td>"<code title="">iso8859-6</code>"
  <tr><td>"<code title="">iso88596</code>"
  <tr><td>"<code title="">iso_8859-6</code>"
  <tr><td>"<code title="">iso_8859-6:1987</code>"
  <tr>
   <td rowspan="12"><a href="#iso-8859-7">iso-8859-7</a>
   <td>"<code title="">csisolatingreek</code>"
  <tr><td>"<code title="">ecma-118</code>"
  <tr><td>"<code title="">elot_928</code>"
  <tr><td>"<code title="">greek</code>"
  <tr><td>"<code title="">greek8</code>"
  <tr><td>"<code title="">iso-8859-7</code>"
  <tr><td>"<code title="">iso-ir-126</code>"
  <tr><td>"<code title="">iso8859-7</code>"
  <tr><td>"<code title="">iso88597</code>"
  <tr><td>"<code title="">iso_8859-7</code>"
  <tr><td>"<code title="">iso_8859-7:1987</code>"
  <tr><td>"<code title="">sun_eu_greek</code>"
  <tr>
   <td rowspan="11"><a href="#iso-8859-8">iso-8859-8</a>
   <td>"<code title="">csiso88598e</code>"
  <tr><td>"<code title="">csisolatinhebrew</code>"
  <tr><td>"<code title="">hebrew</code>"
  <tr><td>"<code title="">iso-8859-8</code>"
  <tr><td>"<code title="">iso-8859-8-e</code>"
  <tr><td>"<code title="">iso-ir-138</code>"
  <tr><td>"<code title="">iso8859-8</code>"
  <tr><td>"<code title="">iso88598</code>"
  <tr><td>"<code title="">iso_8859-8</code>"
  <tr><td>"<code title="">iso_8859-8:1988</code>"
  <tr><td>"<code title="">visual</code>"
  <tr>
   <td rowspan="3"><a href="#iso-8859-8-i">iso-8859-8-i</a>
   <td>"<code title="">csiso88598i</code>"
  <tr><td>"<code title="">iso-8859-8-i</code>"
  <tr><td>"<code title="">logical</code>"
  <tr>
   <td rowspan="7"><a href="#iso-8859-10">iso-8859-10</a>
   <td>"<code title="">csisolatin6</code>"
  <tr><td>"<code title="">iso-8859-10</code>"
  <tr><td>"<code title="">iso-ir-157</code>"
  <tr><td>"<code title="">iso8859-10</code>"
  <tr><td>"<code title="">iso885910</code>"
  <tr><td>"<code title="">l6</code>"
  <tr><td>"<code title="">latin6</code>"
  <tr>
   <td rowspan="3"><a href="#iso-8859-13">iso-8859-13</a>
   <td>"<code title="">iso-8859-13</code>"
  <tr><td>"<code title="">iso8859-13</code>"
  <tr><td>"<code title="">iso885913</code>"
  <tr>
   <td rowspan="3"><a href="#iso-8859-14">iso-8859-14</a>
   <td>"<code title="">iso-8859-14</code>"
  <tr><td>"<code title="">iso8859-14</code>"
  <tr><td>"<code title="">iso885914</code>"
  <tr>
   <td rowspan="6"><a href="#iso-8859-15">iso-8859-15</a>
   <td>"<code title="">csisolatin9</code>"
  <tr><td>"<code title="">iso-8859-15</code>"
  <tr><td>"<code title="">iso8859-15</code>"
  <tr><td>"<code title="">iso885915</code>"
  <tr><td>"<code title="">iso_8859-15</code>"
  <tr><td>"<code title="">l9</code>"
  <tr>
   <td><a href="#iso-8859-16">iso-8859-16</a>
   <td>"<code title="">iso-8859-16</code>"
  <tr>
   <td rowspan="5"><a href="#koi8-r">koi8-r</a>
   <td>"<code title="">cskoi8r</code>"
  <tr><td>"<code title="">koi</code>"
  <tr><td>"<code title="">koi8</code>"
  <tr><td>"<code title="">koi8-r</code>"
  <tr><td>"<code title="">koi8_r</code>"
  <tr>
   <td><a href="#koi8-u">koi8-u</a>
   <td>"<code title="">koi8-u</code>"
  <tr>
   <td rowspan="4"><a href="#macintosh">macintosh</a>
   <td>"<code title="">csmacintosh</code>"
  <tr><td>"<code title="">mac</code>"
  <tr><td>"<code title="">macintosh</code>"
  <tr><td>"<code title="">x-mac-roman</code>"
  <tr>
   <td rowspan="6"><a href="#windows-874">windows-874</a>
   <td>"<code title="">dos-874</code>"
  <tr><td>"<code title="">iso-8859-11</code>"
  <tr><td>"<code title="">iso8859-11</code>"
  <tr><td>"<code title="">iso885911</code>"
  <tr><td>"<code title="">tis-620</code>"
  <tr><td>"<code title="">windows-874</code>"
  <tr>
   <td rowspan="3"><a href="#windows-1250">windows-1250</a>
   <td>"<code title="">cp1250</code>"
  <tr><td>"<code title="">windows-1250</code>"
  <tr><td>"<code title="">x-cp1250</code>"
  <tr>
   <td rowspan="3"><a href="#windows-1251">windows-1251</a>
   <td>"<code title="">cp1251</code>"
  <tr><td>"<code title="">windows-1251</code>"
  <tr><td>"<code title="">x-cp1251</code>"
  <tr>
   <td rowspan="17"><a href="#windows-1252">windows-1252</a>
   <td>"<code title="">ansi_x3.4-1968</code>"
  <tr><td>"<code title="">ascii</code>"
  <tr><td>"<code title="">cp1252</code>"
  <tr><td>"<code title="">cp819</code>"
  <tr><td>"<code title="">csisolatin1</code>"
  <tr><td>"<code title="">ibm819</code>"
  <tr><td>"<code title="">iso-8859-1</code>"
  <tr><td>"<code title="">iso-ir-100</code>"
  <tr><td>"<code title="">iso8859-1</code>"
  <tr><td>"<code title="">iso88591</code>"
  <tr><td>"<code title="">iso_8859-1</code>"
  <tr><td>"<code title="">iso_8859-1:1987</code>"
  <tr><td>"<code title="">l1</code>"
  <tr><td>"<code title="">latin1</code>"
  <tr><td>"<code title="">us-ascii</code>"
  <tr><td>"<code title="">windows-1252</code>"
  <tr><td>"<code title="">x-cp1252</code>"
  <tr>
   <td rowspan="3"><a href="#windows-1253">windows-1253</a>
   <td>"<code title="">cp1253</code>"
  <tr><td>"<code title="">windows-1253</code>"
  <tr><td>"<code title="">x-cp1253</code>"
  <tr>
   <td rowspan="12"><a href="#windows-1254">windows-1254</a>
   <td>"<code title="">cp1254</code>"
  <tr><td>"<code title="">csisolatin5</code>"
  <tr><td>"<code title="">iso-8859-9</code>"
  <tr><td>"<code title="">iso-ir-148</code>"
  <tr><td>"<code title="">iso8859-9</code>"
  <tr><td>"<code title="">iso88599</code>"
  <tr><td>"<code title="">iso_8859-9</code>"
  <tr><td>"<code title="">iso_8859-9:1989</code>"
  <tr><td>"<code title="">l5</code>"
  <tr><td>"<code title="">latin5</code>"
  <tr><td>"<code title="">windows-1254</code>"
  <tr><td>"<code title="">x-cp1254</code>"
  <tr>
   <td rowspan="3"><a href="#windows-1255">windows-1255</a>
   <td>"<code title="">cp1255</code>"
  <tr><td>"<code title="">windows-1255</code>"
  <tr><td>"<code title="">x-cp1255</code>"
  <tr>
   <td rowspan="3"><a href="#windows-1256">windows-1256</a>
   <td>"<code title="">cp1256</code>"
  <tr><td>"<code title="">windows-1256</code>"
  <tr><td>"<code title="">x-cp1256</code>"
  <tr>
   <td rowspan="3"><a href="#windows-1257">windows-1257</a>
   <td>"<code title="">cp1257</code>"
  <tr><td>"<code title="">windows-1257</code>"
  <tr><td>"<code title="">x-cp1257</code>"
  <tr>
   <td rowspan="3"><a href="#windows-1258">windows-1258</a>
   <td>"<code title="">cp1258</code>"
  <tr><td>"<code title="">windows-1258</code>"
  <tr><td>"<code title="">x-cp1258</code>"
  <tr>
   <td rowspan="2"><a href="#x-mac-cyrillic">x-mac-cyrillic</a>
   <td>"<code title="">x-mac-cyrillic</code>"
  <tr><td>"<code title="">x-mac-ukrainian</code>"
 <tbody>
  <tr><th colspan="2"><a href="#legacy-multi-byte-chinese-(simplified)-encodings">Legacy multi-byte Chinese (simplified) encodings</a>
  <tr>
   <td rowspan="10"><a href="#gb18030">gb18030</a>
   <td>"<code title="">chinese</code>"
  <tr><td>"<code title="">csgb2312</code>"
  <tr><td>"<code title="">csiso58gb231280</code>"
  <tr><td>"<code title="">gb18030</code>"
  <tr><td>"<code title="">gb2312</code>"
  <tr><td>"<code title="">gb_2312</code>"
  <tr><td>"<code title="">gb_2312-80</code>"
  <tr><td>"<code title="">gbk</code>"
  <tr><td>"<code title="">iso-ir-58</code>"
  <tr><td>"<code title="">x-gbk</code>"
  <tr>
   <td><a href="#hz-gb-2312">hz-gb-2312</a>
   <td>"<code title="">hz-gb-2312</code>"
 <tbody>
  <tr><th colspan="2"><a href="#legacy-multi-byte-chinese-(traditional)-encodings">Legacy multi-byte Chinese (traditional) encodings</a>
  <tr>
   <td rowspan="5"><a href="#big5">big5</a>
   <td>"<code title="">big5</code>"
  <tr><td>"<code title="">big5-hkscs</code>"
  <tr><td>"<code title="">cn-big5</code>"
  <tr><td>"<code title="">csbig5</code>"
  <tr><td>"<code title="">x-x-big5</code>"
 <tbody>
  <tr><th colspan="2"><a href="#legacy-multi-byte-japanese-encodings">Legacy multi-byte Japanese encodings</a>
  <tr>
   <td rowspan="3"><a href="#euc-jp">euc-jp</a>
   <td>"<code title="">cseucpkdfmtjapanese</code>"
  <tr><td>"<code title="">euc-jp</code>"
  <tr><td>"<code title="">x-euc-jp</code>"
  <tr>
   <td rowspan="2"><a href="#iso-2022-jp">iso-2022-jp</a>
   <td>"<code title="">csiso2022jp</code>"
  <tr><td>"<code title="">iso-2022-jp</code>"
  <tr>
   <td rowspan="7"><a href="#shift_jis">shift_jis</a>
   <td>"<code title="">csshiftjis</code>"
  <tr><td>"<code title="">ms_kanji</code>"
  <tr><td>"<code title="">shift-jis</code>"
  <tr><td>"<code title="">shift_jis</code>"
  <tr><td>"<code title="">sjis</code>"
  <tr><td>"<code title="">windows-31j</code>"
  <tr><td>"<code title="">x-sjis</code>"
 <tbody>
  <tr><th colspan="2"><a href="#legacy-multi-byte-korean-encodings">Legacy multi-byte Korean encodings</a>
  <tr>
   <td rowspan="10"><a href="#euc-kr">euc-kr</a>
   <td>"<code title="">cseuckr</code>"
  <tr><td>"<code title="">csksc56011987</code>"
  <tr><td>"<code title="">euc-kr</code>"
  <tr><td>"<code title="">iso-ir-149</code>"
  <tr><td>"<code title="">korean</code>"
  <tr><td>"<code title="">ks_c_5601-1987</code>"
  <tr><td>"<code title="">ks_c_5601-1989</code>"
  <tr><td>"<code title="">ksc5601</code>"
  <tr><td>"<code title="">ksc_5601</code>"
  <tr><td>"<code title="">windows-949</code>"
 <tbody>
  <tr><th colspan="2"><a href="#legacy-miscellaneous-encodings">Legacy miscellaneous encodings</a>
  <tr>
   <td rowspan="4"><a href="#replacement">replacement</a>
   <td>"<code title="">csiso2022kr</code>"
  <tr><td>"<code title="">iso-2022-cn</code>"
  <tr><td>"<code title="">iso-2022-cn-ext</code>"
  <tr><td>"<code title="">iso-2022-kr</code>"
  <tr>
   <td><a href="#utf-16be">utf-16be</a>
   <td>"<code title="">utf-16be</code>"
  <tr>
   <td rowspan="2"><a href="#utf-16le">utf-16le</a>
   <td>"<code title="">utf-16</code>"
  <tr><td>"<code title="">utf-16le</code>"
  <tr>
   <td><a href="#x-user-defined">x-user-defined</a>
   <td>"<code title="">x-user-defined</code>"
</table>

<p class="note">All <a href="#encoding" title="encoding">encodings</a> and their
<a href="#label" title="label">labels</a> are also available as non-normative
<a href="encodings.json">encodings.json</a> resource.



<h2 id="indexes"><span class="secno">5 </span>Indexes</h2>

<p>Most legacy <a href="#encoding" title="encoding">encodings</a> make use of
an <dfn id="index">index</dfn>. An <a href="#index">index</a> is an ordered list of
pointers and corresponding code points. Within an <a href="#index">index</a>
pointers are unique and code points can be duplicated.

<p class="note no-backref">An efficient implementation likely has two
<a href="#index" title="index">indexes</a> per <a href="#encoding">encoding</a>. One optimized for its
<a href="#decoder">decoder</a> and one for its <a href="#encoder">encoder</a>.

<p>To find the pointers and their corresponding code points in an <a href="#index">index</a>,
let <var title="">lines</var> be the result of splitting the resource's contents on U+000A.
Then remove each item in <var title="">lines</var> that is the empty string or starts with U+0023.
Then the pointers and their corresponding code points are found by splitting each item in <var title="">lines</var> on U+0009.
The first subitem is the pointer (as a decimal number) and the second is the corresponding code point (as a hexadecimal number).
Other subitems are not relevant.

<p>The <dfn id="index-code-point">index code point</dfn> for <var title="">pointer</var> in
<var title="">index</var> is the code point corresponding to
<var title="">pointer</var> in <var title="">index</var>, or null if
<var title="">pointer</var> is not in <var title="">index</var>.

<p>The <dfn id="index-pointer">index pointer</dfn> for <var title="">code point</var> in
<var title="">index</var> is the <em>first</em> pointer corresponding to
<var title="">code point</var> in <var title="">index</var>, or null if
<var title="">code point</var> is not in <var title="">index</var>.

<p>These are the <a href="#index" title="index">indexes</a> defined by this
specification, excluding <a href="#index-single-byte">index single-byte</a>:

<table>
 <tr><th colspan="2"><a href="#index">Index</a><th>Notes
 <tr>
  <td><dfn id="index-big5">index big5</dfn>
  <td><a href="index-big5.txt">index-big5.txt</a>
  <td>This matches the Big5 standard in combination with the
  Hong Kong Supplementary Character Set and other common extensions.
 <tr>
  <td><dfn id="index-euc-kr">index euc-kr</dfn>
  <td><a href="index-euc-kr.txt">index-euc-kr.txt</a>
  <td>This matches the KS X 1001 standard and the Unified Hangul Code, more
  commonly known together as Windows Codepage 949.
 <tr>
  <td><dfn id="index-gb18030">index gb18030</dfn>
  <td><a href="index-gb18030.txt">index-gb18030.txt</a>
  <td>This matches the GB18030 standard for code points encoded as two
  bytes.
 <tr>
  <td><dfn id="index-gb18030-ranges">index gb18030 ranges</dfn>
  <td><a href="index-gb18030-ranges.txt">index-gb18030-ranges.txt</a>
  <td>This <a href="#index">index</a> works different from all others. Listing all
  code points would result in over a million items whereas they can be
  represented neatly in 207 ranges combined with trivial limit checks. It
  therefore only superficially matches the GB18030 standard for code points
  encoded as four bytes. See also <a href="#index-gb18030-ranges-code-point">index gb18030 ranges code point</a> and
  <a href="#index-gb18030-ranges-pointer">index gb18030 ranges pointer</a> below.
 <tr>
  <td><dfn id="index-jis0208">index jis0208</dfn>
  <td><a href="index-jis0208.txt">index-jis0208.txt</a>
  <td>This is the JIS X 0208 standard including formerly proprietary
  extensions from IBM and NEC.
  <!-- NEC = Nippon Electronics Corporation -->
 <tr>
  <td><dfn id="index-jis0212">index jis0212</dfn>
  <td><a href="index-jis0212.txt">index-jis0212.txt</a>
  <td>This is the JIS X 0212 standard.
</table>

<p>The <dfn id="index-gb18030-ranges-code-point">index gb18030 ranges code point</dfn> for <var title="">pointer</var> is
the return value of these steps:

<ol>
 <li><p>If <var title="">pointer</var> is greater than 39419 and less than
 189000, or <var title="">pointer</var> is greater than 1237575, return null.

 <li><p>Let <var>offset</var> be the last pointer in
 <a href="#index-gb18030-ranges">index gb18030 ranges</a> that is equal to or less than
 <var title="">pointer</var> and let <var title="">code point offset</var> be its
 corresponding code point.

 <li><p>Return a code point whose value is
 <var title="">code point offset</var> + <var title="">pointer</var> âˆ’ <var>offset</var>.
</ol>

<p>The <dfn id="index-gb18030-ranges-pointer">index gb18030 ranges pointer</dfn> for <var title="">code point</var> is
the return value of these steps:

<ol>
 <li><p>Let <var>offset</var> be the last code point in
 <a href="#index-gb18030-ranges">index gb18030 ranges</a> that is equal to or less than
 <var title="">code point</var> and let <var title="">pointer offset</var> be its
 corresponding pointer.

 <li><p>Return a pointer whose value is
 <var title="">pointer offset</var> + <var title="">code point</var> âˆ’ <var>offset</var>.
</ol>

<p>The <dfn id="index-shift_jis-pointer">index shift_jis pointer</dfn> for <var title="">code point</var> is the return
value of these steps:

<ol>
 <li><p>Let <var title="">index</var> be <a href="#index-jis0208">index jis0208</a> excluding all pointers in
 the range 8272 to 8835.
 <!-- selected NEC duplicates from IBM extensions later in the index; need to use IBM
      extensions when going back to bytes -->

 <li><p>Return the <a href="#index-pointer">index pointer</a> for <var title="">code point</var> in
 <var title="">index</var>.
</ol>

<hr>

<p class="note no-backref">All <a href="#index" title="index">indexes</a> are also available as
non-normative <a href="indexes.json">indexes.json</a> resource.
(<a href="#index-gb18030-ranges">index gb18030 ranges</a> has a slightly different format here, to be able
to represent ranges.)



<h2 id="specification-hooks"><span class="secno">6 </span>Specification hooks</h2>

<p class="note">The algorithms <a href="#decode">decode</a>, <a href="#utf-8-decode">utf-8 decode</a>,
<a href="#utf-8-decode-without-bom">utf-8 decode without BOM</a>, <a href="#encode">encode</a>, and <a href="#utf-8-encode">utf-8 encode</a>
are intended for usage by other specifications. <a href="#utf-8-decode">utf-8 decode</a> is to be used by
new formats. The <a href="#concept-encoding-get" title="concept-encoding-get">get an encoding</a> algorithm can be
used first to turn a <a href="#label">label</a> into an <a href="#encoding">encoding</a>.

<p>To <dfn id="decode">decode</dfn> a byte stream <var>stream</var> using
fallback encoding <var title="">encoding</var>, run these steps:

<ol>
 <li><p>Let <var>buffer</var> be an empty byte sequence.

 <li><p>Let <var>BOM seen flag</var> be unset.

 <li><p><a href="#concept-stream-read" title="concept-stream-read">Read</a> bytes from <var>stream</var>
 into <var>buffer</var> until either <var>buffer</var> contains three bytes or
 <a href="#concept-stream-read" title="concept-stream-read">read</a> returns <a href="#end-of-stream">end-of-stream</a>.

 <li>
  <p>For each of the rows in the table below, starting with the first
  one and going down, if the first bytes of <var>buffer</var> match
  all the bytes given in the first column, then set <var title="">encoding</var>
  to the <a href="#encoding">encoding</a> given in the cell in the second column of
  that row and set <var>BOM seen flag</var>.

  <table>
   <tr><th>Byte order mark<th>Encoding
   <tr><td>0xEF 0xBB 0xBF<td><a href="#utf-8">utf-8</a>
   <tr><td>0xFE 0xFF<td><a href="#utf-16be">utf-16be</a>
   <tr><td>0xFF 0xFE<td><a href="#utf-16le">utf-16le</a>
  </table>

  <p class="note">For compatibility with deployed content, the byte order mark
  (also known as BOM) is considered more authoritative than anything else.

 <li><p>If <var>BOM seen flag</var> is unset
 <a href="#concept-stream-prepend" title="concept-stream-prepend">prepend</a> <var>buffer</var> to <var>stream</var>.

 <li><p>Otherwise, if <var>BOM seen flag</var> is set, <var title="">encoding</var> is not
 <a href="#utf-8">utf-8</a>, and <var>buffer</var> contains three bytes,
 <a href="#concept-stream-prepend" title="concept-stream-prepend">prepend</a> the last byte of <var>buffer</var> to
 <var>stream</var>.

 <li><p>Let <var>output</var> be a code point <a href="#concept-stream" title="concept-stream">stream</a>.

 <li><p><a href="#concept-encoding-run" title="concept-encoding-run">Run</a> <var title="">encoding</var>'s
 <a href="#decoder">decoder</a> with <var>stream</var> and <var>output</var>.

 <li><p>Return <var>output</var>.
</ol>

<p>To <dfn id="utf-8-decode">utf-8 decode</dfn> a byte stream <var>stream</var>, run
these steps:

<ol>
 <li><p>Let <var>buffer</var> be an empty byte sequence.

 <li><p><a href="#concept-stream-read" title="concept-stream-read">Read</a> three bytes from <var>stream</var>
 into <var>buffer</var>.

 <li><p>If <var>buffer</var> does not match 0xEF 0xBB 0xBF,
 <a href="#concept-stream-prepend" title="concept-stream-prepend">prepend</a> <var>buffer</var> to <var>stream</var>.

 <li><p>Let <var>output</var> be a code point <a href="#concept-stream" title="concept-stream">stream</a>.

 <li><p><a href="#concept-encoding-run" title="concept-encoding-run">Run</a> <a href="#utf-8">utf-8</a>'s
 <a href="#decoder">decoder</a> with <var>stream</var> and <var>output</var>.

 <li><p>Return <var>output</var>.
</ol>

<p>To <dfn id="utf-8-decode-without-bom">utf-8 decode without BOM</dfn> a byte stream <var>stream</var>, run these
steps:

<ol>
 <li><p>Let <var>output</var> be a code point <a href="#concept-stream" title="concept-stream">stream</a>.

 <li><p><a href="#concept-encoding-run" title="concept-encoding-run">Run</a> <a href="#utf-8">utf-8</a>'s
 <a href="#decoder">decoder</a> with <var>stream</var> and <var>output</var>.

 <li><p>Return <var>output</var>.
</ol>


<hr>

<p>To <dfn id="encode">encode</dfn> a code point stream <var>stream</var> using
encoding <var title="">encoding</var>, run these steps:

<ol>
 <li><p>Let <var>output</var> be a byte <a href="#concept-stream" title="concept-stream">stream</a>.

 <li><p><a href="#concept-encoding-run" title="concept-encoding-run">Run</a> <var title="">encoding</var>'s
 <a href="#encoder">encoder</a> with <var>stream</var>, <var>output</var>, and <i>HTML</i>.

 <li><p>Return <var>output</var>.
</ol>

<p class="note no-backref">This is mostly a legacy hook for URLs and HTML forms. Layering
<a href="#utf-8-encode">utf-8 encode</a> on top is safe as it never triggers
<a href="#error" title="error">errors</a>.
<a class="informative" href="#refsURL">[URL]</a>
<a class="informative" href="#refsHTML">[HTML]</a>

<p>To <dfn id="utf-8-encode">utf-8 encode</dfn> a code point stream <var>stream</var>,
return the result of <a href="#encode" title="encode">encoding</a>
<var>stream</var> using encoding <a href="#utf-8">utf-8</a>.

<p class="note no-backref">If the input to <a href="#encode">encode</a> or
<a href="#utf-8-encode">utf-8 encode</a> stems from a DOMString, the
<a class="external" data-anolis-spec="webidl" href="http://heycam.github.io/webidl/#dfn-obtain-unicode">convert a DOMString to a sequence of Unicode characters</a>
from Web IDL is to be used first.



<h2 id="api"><span class="secno">7 </span>API</h2>

<!-- http://wiki.whatwg.org/wiki/StringEncoding  -->

<p>This section uses terminology from the DOM, Typed Arrays, and Web IDL.
Non-browser implementations are not required to implement this API.

<a href="#refsDOM">[DOM]</a>
<a href="#refsTYPEDARRAY">[TYPEDARRAY]</a>
<a href="#refsWEBIDL">[WEBIDL]</a>

<div class="example">
 <p>The following example uses the <a href="#textencoder"><code>TextEncoder</code></a> object to encode
 an array of strings into an
 <a href="http://www.khronos.org/registry/typedarray/specs/latest/#5"><code class="external" data-anolis-spec="typedarray">ArrayBuffer</code></a>. The result is a
 <a href="http://www.khronos.org/registry/typedarray/specs/latest/#7"><code class="external" data-anolis-spec="typedarray">Uint8Array</code></a> containing the number
 of strings (as a <a href="http://www.khronos.org/registry/typedarray/specs/latest/#7"><code class="external" data-anolis-spec="typedarray">Uint32Array</code></a>),
 followed by the length of the first string (as a
 <a href="http://www.khronos.org/registry/typedarray/specs/latest/#7"><code class="external" data-anolis-spec="typedarray">Uint32Array</code></a>), the
 <a href="#utf-8">utf-8</a> encoded string data, the length of the second string (as
 a <a href="http://www.khronos.org/registry/typedarray/specs/latest/#7"><code class="external" data-anolis-spec="typedarray">Uint32Array</code></a>), the string data,
 and so on.
 <pre><code>function encodeArrayOfStrings(strings, encoding) {
  var encoder, encoded, len, i, bytes, view, offset;

  encoder = new TextEncoder(encoding);
  encoded = [];

  len = Uint32Array.BYTES_PER_ELEMENT;
  for (i = 0; i &lt; strings.length; i += 1) {
    len += Uint32Array.BYTES_PER_ELEMENT;
    encoded[i] = new TextEncoder(encoding).encode(strings[i]);
    len += encoded[i].byteLength;
  }

  bytes = new Uint8Array(len);
  view = new DataView(bytes.buffer);
  offset = 0;

  view.setUint32(offset, strings.length);
  offset += Uint32Array.BYTES_PER_ELEMENT;
  for (i = 0; i &lt; encoded.length; i += 1) {
    len = encoded[i].byteLength;
    view.setUint32(offset, len);
    offset += Uint32Array.BYTES_PER_ELEMENT;
    bytes.set(encoded[i], offset);
    offset += len;
  }
  return bytes.buffer;
}</code></pre>

 <p>The following example decodes an
 <a href="http://www.khronos.org/registry/typedarray/specs/latest/#5"><code class="external" data-anolis-spec="typedarray">ArrayBuffer</code></a> containing data
 encoded in the format produced by the previous example back into an array
 of strings.
 <pre><code>function decodeArrayOfStrings(buffer, encoding) {
  var decoder, view, offset, num_strings, strings, i, len;

  decoder = new TextDecoder(encoding);
  view = new DataView(buffer);
  offset = 0;
  strings = [];

  num_strings = view.getUint32(offset);
  offset += Uint32Array.BYTES_PER_ELEMENT;
  for (i = 0; i &lt; num_strings; i += 1) {
    len = view.getUint32(offset);
    offset += Uint32Array.BYTES_PER_ELEMENT;
    strings[i] = decoder.decode(
      new DataView(view.buffer, offset, len));
    offset += len;
  }
  return strings;
}</code></pre>
</div>

<h3 id="interface-textdecoder"><span class="secno">7.1 </span>Interface <code title="">TextDecoder</code></h3>

<pre class="idl">dictionary <dfn id="textdecoderoptions">TextDecoderOptions</dfn> {
  boolean fatal = false;
  boolean ignoreBOM = false;
};

dictionary <dfn id="textdecodeoptions">TextDecodeOptions</dfn> {
  boolean stream = false;
};

[<a href="#dom-textdecoder" title="dom-TextDecoder">Constructor</a>(optional DOMString <var title="">label</var> = "utf-8", optional <a href="#textdecoderoptions">TextDecoderOptions</a> <var title="">options</var>),
 Exposed=Window,Worker]
interface <dfn id="textdecoder">TextDecoder</dfn> {
  readonly attribute DOMString <a href="#dom-textdecoder-encoding" title="dom-TextDecoder-encoding">encoding</a>;
  DOMString <a href="#dom-textdecoder-decode" title="dom-TextDecoder-decode">decode</a>();
  DOMString <a href="#dom-textdecoder-decode" title="dom-TextDecoder-decode">decode</a>(<a class="external" data-anolis-spec="typedarray" href="http://www.khronos.org/registry/typedarray/specs/latest/#6">ArrayBufferView</a> <var title="">input</var>, optional <a href="#textdecodeoptions">TextDecodeOptions</a> <var title="">options</var>);
};</pre>

<p>A <a href="#textdecoder"><code>TextDecoder</code></a> object has an associated <b>encoding</b>, <b>decoder</b>,
<b>stream</b>, <b>ignore BOM flag</b> (initially unset),
<b>BOM seen flag</b> (initially unset),
<b>error mode</b> (initially <i title="">replacement</i>), and
<b>streaming flag</b> (initially unset).

<p>A <a href="#textdecoder"><code>TextDecoder</code></a> object also has an associated
<dfn id="concept-td-serialize" title="concept-TD-serialize">serialize stream</dfn> algorithm, that given a
<a href="#concept-stream" title="concept-stream">stream</a> <var>stream</var>, runs these steps:

<ol>
 <li><p>Let <var>output</var> be the empty <a href="#string">string</a>.

 <li>
  <p>While true:

  <ol>
   <li><p>Let <var>token</var> be the result of
   <a href="#concept-stream-read" title="concept-stream-read">reading</a> from <var>stream</var>.

   <li>
    <p>If <b>encoding</b> is one of <a href="#utf-8">utf-8</a>, <a href="#utf-16be">utf-16be</a>, and
    <a href="#utf-16le">utf-16le</a>, and <b>ignore BOM flag</b> and <b>BOM seen flag</b> are unset,
    run these subsubsteps:

    <ol>
     <li><p>If <var>token</var> is U+FEFF, set <b>BOM seen flag</b>.

     <li><p>Otherwise, if <var>token</var> is not <a href="#end-of-stream">end-of-stream</a>, set
     <b>BOM seen flag</b> and append <var>token</var> to <var>output</var>.

     <li><p>Otherwise, return <var>output</var>.
    </ol>

   <li><p>Otherwise, if token is not <a href="#end-of-stream">end-of-stream</a>, append <var>token</var>
   to <var>output</var>.

   <li><p>Otherwise, return <var>output</var>.
  </ol>
</ol>

<p class="note">This algorithm is intentionally different with respect to BOM handling from
the <a href="#decode">decode</a> algorithm used by the rest of the platform to give API users more
control.

<hr>

<dl class="domintro">
 <dt><code><var title="">decoder</var> = new <a href="#dom-textdecoder" title="dom-TextDecoder">TextDecoder</a>([<var title="">label</var> = "utf-8" [, <var title="">options</var>]])</code>
 <dd>
  <p>Returns a new <a href="#textdecoder"><code>TextDecoder</code></a> object.
  <p>If <var title="">label</var> is either not a <a href="#label">label</a> or is a
  <a href="#label">label</a> for <a href="#replacement">replacement</a>,
  <a class="external" data-anolis-spec="webidl" href="http://heycam.github.io/webidl/#dfn-throw" title="throw">throws</a> a
  <code>TypeError</code>.

 <dt><code><var title="">decoder</var> . <a href="#dom-textdecoder-encoding" title="dom-TextDecoder-encoding">encoding</a></code>
 <dd><p>Returns <b>encoding</b>'s <a href="#name">name</a>.

 <dt><code><var title="">decoder</var> . <a href="#dom-textdecoder-decode" title="dom-TextDecoder-decode">decode</a>([<var title="">input</var> [, <var title="">options</var>]])</code>
 <dd>
  <p>Returns the result of running <b>encoding</b>'s
  <a href="#decoder">decoder</a>. If <var title="">options</var>'s
  <code title="">stream</code> is set to true the method can be invoked
  multiple times to process a fragmented stream.

  <p>If the <b>error mode</b> is <i>fatal</i> set and <b>encoding</b>'s
  <a href="#decoder">decoder</a> returns <a href="#error">error</a>,
  <a class="external" data-anolis-spec="dom" href="http://dom.spec.whatwg.org/#concept-throw" title="concept-throw">throws</a> an
  "<a href="http://dom.spec.whatwg.org/#encodingerror"><code class="external" data-anolis-spec="dom">EncodingError</code></a>".
</dl>

<p>The
<dfn id="dom-textdecoder" title="dom-TextDecoder"><code>TextDecoder(<var title="">label</var>, <var title="">options</var>)</code></dfn>
constructor must run these steps:

<ol>
 <li><p>Let <var title="">encoding</var> be the result of
 <a href="#concept-encoding-get" title="concept-encoding-get">getting an encoding</a> from
 <var title="">label</var>.

 <li><p>If <var title="">encoding</var> is failure or <a href="#replacement">replacement</a>,
 <a class="external" data-anolis-spec="webidl" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> a <code>TypeError</code>.

 <li><p>Let <var title="">dec</var> be a new <a href="#textdecoder"><code>TextDecoder</code></a> object.

 <li><p>Set <var title="">dec</var>'s <b>encoding</b> to
 <var title="">encoding</var>.

 <li><p>If <var title="">options</var>'s <code title="">fatal</code> member is
 true, set <var title="">dec</var>'s <b>error mode</b> to <i>fatal</i>.

 <li><p>If <var title="">options</var>'s <code title="">ignoreBOM</code> member is
 true, set <var title="">dec</var>'s <b>ignore BOM flag</b>.

 <li><p>Return <var title="">dec</var>.
</ol>

<p>The <dfn id="dom-textdecoder-encoding" title="dom-TextDecoder-encoding"><code>encoding</code></dfn> attribute must
return <b>encoding</b>'s <a href="#name">name</a>.

<p>The
<dfn id="dom-textdecoder-decode" title="dom-TextDecoder-decode"><code>decode(<var title="">input</var>, <var title="">options</var>)</code></dfn>
method must run these steps:

<ol>
 <li><p>If the <b>streaming flag</b> is unset, set <b>decoder</b> to a new
 <b>encoding</b>'s <a href="#decoder">decoder</a>, set <b>stream</b> to a new
 <a href="#concept-stream" title="concept-stream">stream</a>, and unset the <b>BOM seen flag</b>.

 <li><p>If <var title="">options</var>'s <code title="">stream</code> is true, set the
 <b>streaming flag</b>, and unset the <b>streaming flag</b> otherwise.

 <li><p>If <var title="">input</var> is given, then given
 <var title="">input</var>'s <code title="">buffer</code>,
 <code title="">byteOffset</code>, and <code title="">byteLength</code>,
 <a href="#concept-stream-push" title="concept-stream-push">push</a> <code title="">byteLength</code> bytes from
 <code title="">buffer</code>, starting at <code title="">byteOffset</code>, to <b>stream</b>.
 <!-- XXX JavaScript / IDL really needs to make this simpler -->

 <li><p>Let <var>output</var> be a new <a href="#concept-stream" title="concept-stream">stream</a>.

 <li>
  <p>While true:

  <ol>
   <li><p>Let <var>token</var> be the result of
   <a href="#concept-stream-read" title="concept-stream-read">reading</a> from <b>stream</b>.

   <li><p>If <var>token</var> is <a href="#end-of-stream">end-of-stream</a> and the <b>streaming flag</b>
   is set, return <var>output</var>, <a href="#concept-td-serialize" title="concept-TD-serialize">serialized</a>.

   <li>
    <p>Otherwise, run these subsubsteps:

    <ol>
     <li><p>Let <var>result</var> be the result of
     <a href="#concept-encoding-process" title="concept-encoding-process">processing</a> <var>token</var> for
     <b>decoder</b>, <b>stream</b>, <var>output</var>, and <b>error mode</b>.

     <li><p>If <var>result</var> is <a href="#finished">finished</a>, return <var>output</var>,
     <a href="#concept-td-serialize" title="concept-TD-serialize">serialized</a>.

     <li><p>Otherwise, if <var>result</var> is <a href="#error">error</a>,
     <a class="external" data-anolis-spec="dom" href="http://dom.spec.whatwg.org/#concept-throw" title="concept-throw">throw</a> an
     "<code title="">EncodingError</code>"

     <li><p>Otherwise, do nothing.
    </ol>
  </ol>
</ol>


<h3 id="interface-textencoder"><span class="secno">7.2 </span>Interface <code title="">TextEncoder</code></h3>

<pre class="idl">dictionary <dfn id="textencodeoptions">TextEncodeOptions</dfn> {
  boolean stream = false;
};

[<a href="#dom-textencoder" title="dom-TextEncoder">Constructor</a>(optional DOMString <var title="">utfLabel</var> = "utf-8"),
 Exposed=Window,Worker]
interface <dfn id="textencoder">TextEncoder</dfn> {
  readonly attribute DOMString <a href="#dom-textencoder-encoding" title="dom-TextEncoder-encoding">encoding</a>;
  <a class="external" data-anolis-spec="typedarray" href="http://www.khronos.org/registry/typedarray/specs/latest/#7">Uint8Array</a> <a href="#dom-textencoder-encode" title="dom-TextEncoder-encode">encode</a>(optional [EnsureUTF16] DOMString <var title="">input</var> = "", optional <a href="#textencodeoptions">TextEncodeOptions</a> <var title="">options</var>);
};</pre>

<p>A <a href="#textencoder"><code>TextEncoder</code></a> object has an associated <b>encoding</b>, <b>encoder</b>,
<b>stream</b>, and <b>streaming flag</b> (initially unset).

<p>A <a href="#textencoder"><code>TextEncoder</code></a> object also has an associated
<dfn id="concept-te-serialize" title="concept-TE-serialize">serialize stream</dfn> algorithm, that given a
<a href="#concept-stream" title="concept-stream">stream</a> <var>stream</var>, runs these steps:

<ol>
 <li><p>Let <var>buffer</var> be a byte sequence.

 <li><p>Keep <a href="#concept-stream-read" title="concept-stream-read">reading</a> from <var>stream</var> into
 <var>buffer</var> until <a href="#end-of-stream">end-of-stream</a>.

 <li><p>Return a <a href="http://www.khronos.org/registry/typedarray/specs/latest/#7"><code class="external" data-anolis-spec="typedarray">Uint8Array</code></a> object wrapping an
 <a href="http://www.khronos.org/registry/typedarray/specs/latest/#5"><code class="external" data-anolis-spec="typedarray">ArrayBuffer</code></a> containing <var title="">bytes</var>.
 <!-- XXX JavaScript / IDL hook? -->
</ol>

<hr>

<dl class="domintro">
 <dt><code><var title="">encoder</var> = new <a href="#dom-textencoder" title="dom-TextEncoder">TextEncoder</a>([<var title="">utfLabel</var> = "utf-8"])</code>
 <dd>
  <p>Returns a new <a href="#textencoder"><code>TextEncoder</code></a> object.
  <p>If <var title="">utfLabel</var> is not a <a href="#label">label</a> for
  <a href="#utf-8">utf-8</a>, <a href="#utf-16be">utf-16be</a>, or <a href="#utf-16le">utf-16le</a>,
  <a class="external" data-anolis-spec="webidl" href="http://heycam.github.io/webidl/#dfn-throw" title="throw">throws</a> a
  <code>TypeError</code>.

 <dt><code><var title="">encoder</var> . <a href="#dom-textencoder-encoding" title="dom-TextEncoder-encoding">encoding</a></code>
 <dd><p>Returns <b>encoding</b>'s <a href="#name">name</a>.

 <dt><code><var title="">encoder</var> . <a href="#dom-textencoder-encode" title="dom-TextEncoder-encode">encode</a>([<var title="">input</var> [, <var title="">options</var>]])</code>
 <dd><p>Returns the result of running <b>encoding</b>'s
 <a href="#encoder">encoder</a>. If <var title="">options</var>'s
 <code title="">stream</code> is set to true, the method can be invoked
 multiple times to process a fragmented stream.
</dl>

<p>The
<dfn id="dom-textencoder" title="dom-TextEncoder"><code>TextEncoder(<var title="">utfLabel</var>)</code></dfn>
constructor must run these steps:

<ol>
 <li><p>Let <var title="">encoding</var> be the result of
 <a href="#concept-encoding-get" title="concept-encoding-get">getting an encoding</a> from
 <var title="">utfLabel</var>.

 <li><p>If <var title="">encoding</var> is failure, or is none of
 <a href="#utf-8">utf-8</a>, <a href="#utf-16be">utf-16be</a>, and <a href="#utf-16le">utf-16le</a>,
 <a class="external" data-anolis-spec="webidl" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> a <code>TypeError</code>.

 <li><p>Let <var title="">enc</var> be a new <a href="#textencoder"><code>TextEncoder</code></a> object.

 <li><p>Set <var title="">enc</var>'s <b>encoding</b> to <var title="">encoding</var>.

 <li><p>Return <var title="">enc</var>.
</ol>

<p>The <dfn id="dom-textencoder-encoding" title="dom-TextEncoder-encoding"><code>encoding</code></dfn>
attribute must return <b>encoding</b>'s <a href="#name">name</a>.

<p>The
<dfn id="dom-textencoder-encode" title="dom-TextEncoder-encode"><code>encode(<var title="">input</var>, <var title="">options</var>)</code></dfn>
method must run these steps:

<ol>
 <li><p>If the <b>streaming flag</b> is unset, set <b>encoder</b> to a new
 <b>encoding</b>'s <a href="#encoder">encoder</a> and set <b>stream</b> to a new
 <a href="#concept-stream" title="concept-stream">stream</a>.

 <li><p>If <var title="">options</var>'s <code title="">stream</code> is true, set the
 <b>streaming flag</b>, and unset the <b>streaming flag</b> otherwise.

 <li><p><a href="#concept-stream-push" title="concept-stream-push">Push</a> <var title="">input</var> to <b>stream</b>.

 <li><p>Let <var>output</var> be a new <a href="#concept-stream" title="concept-stream">stream</a>.

 <li>
  <p>While true:

  <ol>
   <li><p>Let <var>token</var> be the result of
   <a href="#concept-stream-read" title="concept-stream-read">reading</a> from <b>stream</b>.

   <li><p>If <var>token</var> is <a href="#end-of-stream">end-of-stream</a> and the <b>streaming flag</b>
   is set, return <var>output</var>, <a href="#concept-te-serialize" title="concept-TE-serialize">serialized</a>.

   <li>
    <p>Otherwise, run these subsubsteps:

    <ol>
     <li><p>Let <var>result</var> be the result of
     <a href="#concept-encoding-process" title="concept-encoding-process">processing</a> <var>token</var> for
     <b>encoder</b>, <b>stream</b>, <var>output</var>.

     <li><p>If <var>result</var> is <a href="#finished">finished</a>, return <var>output</var>,
     <a href="#concept-te-serialize" title="concept-TE-serialize">serialized</a>.

     <li><p>Otherwise, do nothing.
    </ol>

    <p class="note">These <a href="#encoding" title="encoding">encodings</a> cannot return
    <a href="#error">error</a>. <!-- XXX surrogates?! -->
  </ol>
</ol>



<h2 id="the-encoding"><span class="secno">8 </span>The encoding</h2>

<h3 id="utf-8"><span class="secno">8.1 </span><dfn>utf-8</dfn></h3>

<h4 id="utf-8-decoder"><span class="secno">8.1.1 </span><dfn>utf-8 decoder</dfn></h4>

<p><a href="#utf-8">utf-8</a>'s <a href="#decoder">decoder</a>'s has an associated
<dfn id="utf-8-code-point">utf-8 code point</dfn>, <dfn id="utf-8-bytes-seen">utf-8 bytes seen</dfn>, and
<dfn id="utf-8-bytes-needed">utf-8 bytes needed</dfn> (all initially 0), a <dfn id="utf-8-lower-boundary">utf-8 lower boundary</dfn>
(initially 0x80), and a <dfn id="utf-8-upper-boundary">utf-8 upper boundary</dfn> (initially 0xBF).

<p><a href="#utf-8">utf-8</a>'s <a href="#decoder">decoder</a>'s <a href="#handler">handler</a>, given a
<var>stream</var> and <var title="">byte</var>, runs these steps:

<ol>
 <li><p>If <var title="">byte</var> is <a href="#end-of-stream">end-of-stream</a> and
 <a href="#utf-8-bytes-needed">utf-8 bytes needed</a> is not 0, set
 <a href="#utf-8-bytes-needed">utf-8 bytes needed</a> to 0 and return <a href="#error">error</a>.

 <li><p>If <var title="">byte</var> is <a href="#end-of-stream">end-of-stream</a>, return
 <a href="#finished">finished</a>.

 <li>
  <p>If <a href="#utf-8-bytes-needed">utf-8 bytes needed</a> is 0, based on
  <var title="">byte</var>:

  <dl class="switch">
   <dt>0x00 to 0x7F
   <dd><p>Return a code point whose value is <var title="">byte</var>.

   <dt>0xC2 to 0xDF
   <dd><p>Set <a href="#utf-8-bytes-needed">utf-8 bytes needed</a> to 1 and
   <a href="#utf-8-code-point">utf-8 code point</a> to <var title="">byte</var> âˆ’ 0xC0.

   <dt>0xE0 to 0xEF
   <dd>
    <ol>
     <li><p>If <var title="">byte</var> is 0xE0, set
     <a href="#utf-8-lower-boundary">utf-8 lower boundary</a> to 0xA0.

     <li><p>If <var title="">byte</var> is 0xED, set
     <a href="#utf-8-upper-boundary">utf-8 upper boundary</a> to 0x9F.

     <li><p>Set <a href="#utf-8-bytes-needed">utf-8 bytes needed</a> to 2 and
     <a href="#utf-8-code-point">utf-8 code point</a> to <var title="">byte</var> âˆ’ 0xE0.
    </ol>

   <dt>0xF0 to 0xF4
   <dd>
    <ol>
     <li><p>If <var title="">byte</var> is 0xF0, set
     <a href="#utf-8-lower-boundary">utf-8 lower boundary</a> to 0x90.

     <li><p>If <var title="">byte</var> is 0xF4, set
     <a href="#utf-8-upper-boundary">utf-8 upper boundary</a> to 0x8F.

     <li><p>Set <a href="#utf-8-bytes-needed">utf-8 bytes needed</a> to 3 and
     <a href="#utf-8-code-point">utf-8 code point</a> to <var title="">byte</var> âˆ’ 0xF0.
    </ol>

   <dt>Otherwise
   <dd><p>Return <a href="#error">error</a>.
  </dl>

  <p>Then (<var title="">byte</var> is in the range 0xC2 to 0xF4) set
  <a href="#utf-8-code-point">utf-8 code point</a> to
  <a href="#utf-8-code-point">utf-8 code point</a> &lt;&lt; (6 Ã— <a href="#utf-8-bytes-needed">utf-8 bytes needed</a>)
  and return <a href="#continue">continue</a>.

 <li>
  <p>If <var title="">byte</var> is not in the range
  <a href="#utf-8-lower-boundary">utf-8 lower boundary</a> to <a href="#utf-8-upper-boundary">utf-8 upper boundary</a>,
  run these substeps:

  <ol>
   <li><p>Set <a href="#utf-8-code-point">utf-8 code point</a>,
   <a href="#utf-8-bytes-needed">utf-8 bytes needed</a>, and <a href="#utf-8-bytes-seen">utf-8 bytes seen</a> to 0,
   set <a href="#utf-8-lower-boundary">utf-8 lower boundary</a> to 0x80, and set
   <a href="#utf-8-upper-boundary">utf-8 upper boundary</a> to 0xBF.

   <li><p><a href="#concept-stream-prepend" title="concept-stream-prepend">Prepend</a> <var title="">byte</var> to
   <var>stream</var>.

   <li><p>Return <a href="#error">error</a>.
  </ol>

 <li><p>Set <a href="#utf-8-lower-boundary">utf-8 lower boundary</a> to 0x80 and
 <a href="#utf-8-upper-boundary">utf-8 upper boundary</a> to 0xBF.

 <li>
  <p>Increase <a href="#utf-8-bytes-seen">utf-8 bytes seen</a> by one and set
  <a href="#utf-8-code-point">utf-8 code point</a> to
  <a href="#utf-8-code-point">utf-8 code point</a> + (<var title="">byte</var> âˆ’ 0x80) &lt;&lt;
  (6 Ã— (<a href="#utf-8-bytes-needed">utf-8 bytes needed</a> âˆ’ <a href="#utf-8-bytes-seen">utf-8 bytes seen</a>)).

 <li><p>If <a href="#utf-8-bytes-seen">utf-8 bytes seen</a> is not equal to
 <a href="#utf-8-bytes-needed">utf-8 bytes needed</a>, continue.

 <li><p>Let <var title="">code point</var> be <a href="#utf-8-code-point">utf-8 code point</a>.

 <li><p>Set <a href="#utf-8-code-point">utf-8 code point</a>,
 <a href="#utf-8-bytes-needed">utf-8 bytes needed</a>, and <a href="#utf-8-bytes-seen">utf-8 bytes seen</a> to 0.

 <li><p>Emit a code point whose value is <var title="">code point</var>.
</ol>

<p class="note">The constraints in the <a href="#utf-8-decoder">utf-8 decoder</a> above match
â€œBest Practices for Using U+FFFDâ€ from the Unicode standard. No other
behavior is permitted per the Encoding Standard (other algorithms that
achieve the same result are obviously fine, even encouraged).


<h4 id="utf-8-encoder"><span class="secno">8.1.2 </span><dfn>utf-8 encoder</dfn></h4>

<p><a href="#utf-8">utf-8</a>'s <a href="#encoder">encoder</a>'s <a href="#handler">handler</a>, given a
<var>stream</var> and <var title="">code point</var>, runs these steps:

<ol>
 <li><p>If <var title="">code point</var> is <a href="#end-of-stream">end-of-stream</a>, return
 <a href="#finished">finished</a>.

 <li><p>If <var title="">code point</var> is in the range U+0000 to U+007F, return
 a byte whose value is <var title="">code point</var>.

 <li>
  <p>Set <var title="">count</var> and <var>offset</var> based on the
  range <var title="">code point</var> is in:

  <dl class="switch">
   <dt>U+0080 to U+07FF
   <dd>1 and 0xC0
   <dt>U+0800 to U+FFFF
   <dd>2 and 0xE0
   <dt>U+10000 to U+10FFFF
   <dd>3 and 0xF0
  </dl>

 <li><p>Let <var title="">bytes</var> be a byte sequence whose first byte is
 (<var title="">code point</var> &gt;&gt; (6 Ã— <var title="">count</var>)) + <var>offset</var>.

 <li>
  <p>Run these substeps while <var title="">count</var> is greater than 0:

  <ol>
   <li><p>Set <var title="">temp</var> to
   <var title="">code point</var> &gt;&gt; (6 Ã— (<var title="">count</var> âˆ’ 1)).

   <li><p>Append to <var title="">bytes</var> 0x80 | (<var title="">temp</var> &amp; 0x3F).

   <li><p>Decrease <var title="">count</var> by one.
  </ol>

 <li><p>Return bytes <var title="">bytes</var>, in order.
</ol>



<h2 id="legacy-single-byte-encodings"><span class="secno">9 </span>Legacy single-byte encodings</h2>

<p>An <a href="#encoding">encoding</a> where each byte is either a single code point or
nothing, is a <dfn id="single-byte-encoding">single-byte encoding</dfn>.
<a href="#single-byte-encoding" title="single-byte encoding">Single-byte encodings</a> share the
<a href="#decoder">decoder</a> and <a href="#encoder">encoder</a>. <dfn id="index-single-byte">Index single-byte</dfn>,
as referenced by the <a href="#single-byte-decoder">single-byte decoder</a> and
<a href="#single-byte-encoder">single-byte encoder</a>,  is defined by the following table, and
depends on the <a href="#single-byte-encoding">single-byte encoding</a> in use. All but two
<a href="#single-byte-encoding" title="single-byte encoding">single-byte encodings</a> have a
unique <a href="#index">index</a>.

<table>
 <tr><th><a href="#name">Name</a><th><a href="#index">Index</a>
 <tr><td><dfn id="ibm866">ibm866</dfn><td><a href="index-ibm866.txt">index-ibm866.txt</a>
 <tr><td><dfn id="iso-8859-2">iso-8859-2</dfn><td><a href="index-iso-8859-2.txt">index-iso-8859-2.txt</a>
 <tr><td><dfn id="iso-8859-3">iso-8859-3</dfn><td><a href="index-iso-8859-3.txt">index-iso-8859-3.txt</a>
 <tr><td><dfn id="iso-8859-4">iso-8859-4</dfn><td><a href="index-iso-8859-4.txt">index-iso-8859-4.txt</a>
 <tr><td><dfn id="iso-8859-5">iso-8859-5</dfn><td><a href="index-iso-8859-5.txt">index-iso-8859-5.txt</a>
 <tr><td><dfn id="iso-8859-6">iso-8859-6</dfn><td><a href="index-iso-8859-6.txt">index-iso-8859-6.txt</a>
 <tr><td><dfn id="iso-8859-7">iso-8859-7</dfn><td><a href="index-iso-8859-7.txt">index-iso-8859-7.txt</a>
 <tr><td><dfn id="iso-8859-8">iso-8859-8</dfn><td><a href="index-iso-8859-8.txt">index-iso-8859-8.txt</a>
 <tr><td><dfn id="iso-8859-8-i">iso-8859-8-i</dfn><td><a href="index-iso-8859-8.txt">index-iso-8859-8.txt</a>
 <tr><td><dfn id="iso-8859-10">iso-8859-10</dfn><td><a href="index-iso-8859-10.txt">index-iso-8859-10.txt</a>
 <tr><td><dfn id="iso-8859-13">iso-8859-13</dfn><td><a href="index-iso-8859-13.txt">index-iso-8859-13.txt</a>
 <tr><td><dfn id="iso-8859-14">iso-8859-14</dfn><td><a href="index-iso-8859-14.txt">index-iso-8859-14.txt</a>
 <tr><td><dfn id="iso-8859-15">iso-8859-15</dfn><td><a href="index-iso-8859-15.txt">index-iso-8859-15.txt</a>
 <tr><td><dfn id="iso-8859-16">iso-8859-16</dfn><td><a href="index-iso-8859-16.txt">index-iso-8859-16.txt</a>
 <tr><td><dfn id="koi8-r">koi8-r</dfn><td><a href="index-koi8-r.txt">index-koi8-r.txt</a>
 <tr><td><dfn id="koi8-u">koi8-u</dfn><td><a href="index-koi8-u.txt">index-koi8-u.txt</a>
 <tr><td><dfn id="macintosh">macintosh</dfn><td><a href="index-macintosh.txt">index-macintosh.txt</a>
 <tr><td><dfn id="windows-874">windows-874</dfn><td><a href="index-windows-874.txt">index-windows-874.txt</a>
 <tr><td><dfn id="windows-1250">windows-1250</dfn><td><a href="index-windows-1250.txt">index-windows-1250.txt</a>
 <tr><td><dfn id="windows-1251">windows-1251</dfn><td><a href="index-windows-1251.txt">index-windows-1251.txt</a>
 <tr><td><dfn id="windows-1252">windows-1252</dfn><td><a href="index-windows-1252.txt">index-windows-1252.txt</a>
 <tr><td><dfn id="windows-1253">windows-1253</dfn><td><a href="index-windows-1253.txt">index-windows-1253.txt</a>
 <tr><td><dfn id="windows-1254">windows-1254</dfn><td><a href="index-windows-1254.txt">index-windows-1254.txt</a>
 <tr><td><dfn id="windows-1255">windows-1255</dfn><td><a href="index-windows-1255.txt">index-windows-1255.txt</a>
 <tr><td><dfn id="windows-1256">windows-1256</dfn><td><a href="index-windows-1256.txt">index-windows-1256.txt</a>
 <tr><td><dfn id="windows-1257">windows-1257</dfn><td><a href="index-windows-1257.txt">index-windows-1257.txt</a>
 <tr><td><dfn id="windows-1258">windows-1258</dfn><td><a href="index-windows-1258.txt">index-windows-1258.txt</a>
 <tr><td><dfn id="x-mac-cyrillic">x-mac-cyrillic</dfn><td><a href="index-x-mac-cyrillic.txt">index-x-mac-cyrillic.txt</a>
</table>

<p class="note"><a href="#iso-8859-8">iso-8859-8</a> and <a href="#iso-8859-8-i">iso-8859-8-i</a> are
distinct <a href="#encoding">encoding</a> <a href="#name" title="name">names</a>, because
<a href="#iso-8859-8">iso-8859-8</a> has influence on the layout direction. And although
historically this might have been the case for <a href="#iso-8859-6">iso-8859-6</a> and
"iso-8859-6-i" as well, that is no longer true.
<!-- https://www.w3.org/Bugs/Public/show_bug.cgi?id=19505 -->

<h3 id="single-byte-decoder"><span class="secno">9.1 </span><dfn>single-byte decoder</dfn></h3>

<p><a href="#single-byte-encoding" title="single-byte encoding">Single-byte encodings</a>'s
<a href="#decoder">decoder</a>'s <a href="#handler">handler</a>, given a
<var>stream</var> and <var title="">byte</var>, runs these steps:

<ol>
 <li><p>If <var title="">byte</var> is <a href="#end-of-stream">end-of-stream</a>, return
 <a href="#finished">finished</a>.

 <li><p>If <var title="">byte</var> is in the range 0x00 to 0x7F, return
 a code point whose value is <var title="">byte</var>.

 <li><p>Let <var title="">code point</var> be the <a href="#index-code-point">index code point</a>
 for <var title="">byte</var> âˆ’ 0x80 in <a href="#index-single-byte">index single-byte</a>.

 <li><p>If <var title="">code point</var> is null, return <a href="#error">error</a>.

 <li><p>Return a code point whose value is <var title="">code point</var>.
</ol>

<h3 id="single-byte-encoder"><span class="secno">9.2 </span><dfn>single-byte encoder</dfn></h3>

<p><a href="#single-byte-encoding" title="single-byte encoding">Single-byte encodings</a>'s
<a href="#encoder">encoder</a>'s <a href="#handler">handler</a>, given a
<var>stream</var> and <var title="">code point</var>, runs these steps:

<ol>
 <li><p>If <var title="">code point</var> is <a href="#end-of-stream">end-of-stream</a>, return
 <a href="#finished">finished</a>.

 <li><p>If <var title="">code point</var> is in the range U+0000 to U+007F, return
 a byte whose value is <var title="">code point</var>.

 <li><p>Let <var title="">pointer</var> be the <a href="#index-pointer">index pointer</a> for
 <var title="">code point</var> in <a href="#index-single-byte">index single-byte</a>.

 <li><p>If <var title="">pointer</var> is null, return <a href="#error">error</a> with
 <var title="">code point</var>.

 <li><p>Return a byte whose value is <var title="">pointer</var> + 0x80.
</ol>



<h2 id="legacy-multi-byte-chinese-(simplified)-encodings"><span class="secno">10 </span>Legacy multi-byte Chinese (simplified) encodings</h2>


<h3 id="gb18030"><span class="secno">10.1 </span><dfn>gb18030</dfn></h3>

<h4 id="gb18030-decoder"><span class="secno">10.1.1 </span><dfn>gb18030 decoder</dfn></h4>

<p><a href="#gb18030">gb18030</a>'s <a href="#decoder">decoder</a> has an associated <dfn id="gb18030-first">gb18030 first</dfn>,
<dfn id="gb18030-second">gb18030 second</dfn>, and <dfn id="gb18030-third">gb18030 third</dfn> (all initially 0x00).

<p><a href="#gb18030">gb18030</a>'s <a href="#decoder">decoder</a>'s <a href="#handler">handler</a>, given a
<var>stream</var> and <var title="">byte</var>, runs these steps:

<ol>
 <li><p>If <var title="">byte</var> is <a href="#end-of-stream">end-of-stream</a> and
 <a href="#gb18030-first">gb18030 first</a>, <a href="#gb18030-second">gb18030 second</a>, and <a href="#gb18030-third">gb18030 third</a>
 are 0x00, return <a href="#finished">finished</a>.

 <li><p>If <var title="">byte</var> is <a href="#end-of-stream">end-of-stream</a>, and
 <a href="#gb18030-first">gb18030 first</a>, <a href="#gb18030-second">gb18030 second</a>, or <a href="#gb18030-third">gb18030 third</a>
 is not 0x00, set <a href="#gb18030-first">gb18030 first</a>, <a href="#gb18030-second">gb18030 second</a>, and
 <a href="#gb18030-third">gb18030 third</a> to 0x00, and return <a href="#error">error</a>.

 <li>
  <p>If <a href="#gb18030-third">gb18030 third</a> is not 0x00, run these substeps:

  <ol>
   <li><p>Let <var title="">code point</var> be null.

   <li><p>If <var title="">byte</var> is in the range 0x30 to 0x39, set
   <var title="">code point</var> to the
   <a href="#index-gb18030-ranges-code-point">index gb18030 ranges code point</a> for
   (((<a href="#gb18030-first">gb18030 first</a> âˆ’ 0x81) Ã— 10 + <a href="#gb18030-second">gb18030 second</a> âˆ’ 0x30) Ã— 126 + <a href="#gb18030-third">gb18030 third</a> âˆ’ 0x81) Ã— 10 + <var title="">byte</var> âˆ’ 0x30.

   <li><p>Let <var>buffer</var> be a byte sequence consisting of
   <a href="#gb18030-second">gb18030 second</a>, <a href="#gb18030-third">gb18030 third</a>, and <var title="">byte</var>, in
   order.

   <li><p>Set <a href="#gb18030-first">gb18030 first</a>, <a href="#gb18030-second">gb18030 second</a>, and
   <a href="#gb18030-third">gb18030 third</a> to 0x00.

   <li><p>If <var title="">code point</var> is null,
   <a href="#concept-stream-prepend" title="concept-stream-prepend">prepend</a> <var>buffer</var> to
   <var>stream</var> and return <a href="#error">error</a>.

   <li><p>Return a code point whose value is <var title="">code point</var>.
  </ol>

 <li>
  <p>If <a href="#gb18030-second">gb18030 second</a> is not 0x00, run these substeps:

  <ol>
   <li><p>If <var title="">byte</var> is in the range 0x81 to 0xFE, set
   <a href="#gb18030-third">gb18030 third</a> to <var title="">byte</var> and return <a href="#continue">continue</a>.

   <li><p><a href="#concept-stream-prepend" title="concept-stream-prepend">Prepend</a> <a href="#gb18030-second">gb18030 second</a>
   followed by <var title="">byte</var> to <var>stream</var>, set
   <a href="#gb18030-first">gb18030 first</a> and <a href="#gb18030-second">gb18030 second</a> to 0x00, and return
   <a href="#error">error</a>.
  </ol>

 <li>
  <p>If <a href="#gb18030-first">gb18030 first</a> is not 0x00, run these substeps:

  <ol>
   <li><p>If <var title="">byte</var> is in the range 0x30 to 0x39, set
   <a href="#gb18030-second">gb18030 second</a> to <var title="">byte</var> and return <a href="#continue">continue</a>.

   <li><p>Let <var>lead</var> be <a href="#gb18030-first">gb18030 first</a>, let
   <var title="">pointer</var> be null, and set <a href="#gb18030-first">gb18030 first</a> to 0x00.

   <li><p>Let <var>offset</var> be 0x40 if <var title="">byte</var> is
   less than 0x7F and 0x41 otherwise.

   <li><p>If <var title="">byte</var> is in the range 0x40 to 0x7E or
   0x80 to 0xFE, set <var title="">pointer</var> to
   (<var>lead</var> âˆ’ 0x81) Ã— 190 + (<var title="">byte</var> âˆ’ <var>offset</var>).

   <li><p>Let <var title="">code point</var> be null if
   <var title="">pointer</var> is null and the <a href="#index-code-point">index code point</a>
   for <var title="">pointer</var> in <a href="#index-gb18030">index gb18030</a> otherwise.

   <li><p>If <var title="">pointer</var> is null,
   <a href="#concept-stream-prepend" title="concept-stream-prepend">prepend</a> <var title="">byte</var> to
   <var>stream</var>.

   <li><p>If <var title="">code point</var> is null, return <a href="#error">error</a>.

   <li><p>Return a code point whose value is <var title="">code point</var>.
  </ol>

 <li><p>If <var title="">byte</var> is in the range 0x00 to 0x7F, return
 a code point whose value is <var title="">byte</var>.

 <li><p>If <var title="">byte</var> is 0x80, return code point U+20AC.

 <li><p>If <var title="">byte</var> is in the range 0x81 to 0xFE, set
 <a href="#gb18030-first">gb18030 first</a> to <var title="">byte</var> and return <a href="#continue">continue</a>.

 <li><p>Return <a href="#error">error</a>.
</ol>


<h4 id="gb18030-encoder"><span class="secno">10.1.2 </span><dfn>gb18030 encoder</dfn></h4>

<p><a href="#gb18030">gb18030</a>'s <a href="#encoder">encoder</a>'s <a href="#handler">handler</a>, given a
<var>stream</var> and <var title="">code point</var>, runs these steps:

<ol>
 <li><p>If <var title="">code point</var> is <a href="#end-of-stream">end-of-stream</a>, return
 <a href="#finished">finished</a>.

 <li><p>If <var title="">code point</var> is in the range U+0000 to U+007F, return
 a byte whose value is <var title="">code point</var>.

 <li><p>Let <var title="">pointer</var> be the <a href="#index-pointer">index pointer</a> for
 <var title="">code point</var> in <a href="#index-gb18030">index gb18030</a>.

 <li>
  <p>If <var title="">pointer</var> is not null, run these substeps:

  <ol>
   <li><p>Let <var>lead</var> be
   <var title="">pointer</var> / 190 + 0x81.

   <li><p>Let <var>trail</var> be <var title="">pointer</var> % 190.

   <li><p>Let <var>offset</var> be 0x40 if <var>trail</var> is
   less than 0x3F<!--0x7F-0x40--> and 0x41 otherwise.

   <li><p>Return two bytes whose values are <var>lead</var> and
   <var>trail</var> + <var>offset</var>.
  </ol>

 <li><p>Set <var title="">pointer</var> to the
 <a href="#index-gb18030-ranges-pointer">index gb18030 ranges pointer</a> for <var title="">code point</var>.

 <li><p>Let <var title="">byte1</var> be
 <var title="">pointer</var> / 10 / 126 / 10.

 <li><p>Set <var title="">pointer</var> to
 <var title="">pointer</var> âˆ’ <var title="">byte1</var> Ã— 10 Ã— 126 Ã— 10.

 <li><p>Let <var title="">byte2</var> be
 <var title="">pointer</var> / 10 / 126.

 <li><p>Set <var title="">pointer</var> to
 <var title="">pointer</var> âˆ’ <var title="">byte2</var> Ã— 10 Ã— 126.

 <li><p>Let <var title="">byte3</var> be
 <var title="">pointer</var> / 10.

 <li><p>Let <var title="">byte4</var> be
 <var title="">pointer</var> âˆ’ <var title="">byte3</var> Ã— 10.

 <li><p>Return four bytes whose values are <var title="">byte1</var> + 0x81,
 <var title="">byte2</var> + 0x30, <var title="">byte3</var> + 0x81,
 <var title="">byte4</var> + 0x30.
</ol>


<h3 id="hz-gb-2312"><span class="secno">10.2 </span><dfn>hz-gb-2312</dfn></h3>

<p class="XXX">This encoding is <a href="https://www.w3.org/Bugs/Public/show_bug.cgi?id=25339">considered for removal</a>.

<!--
 http://tools.ietf.org/html/rfc1842
 http://tools.ietf.org/html/rfc1843
-->

<h4 id="hz-gb-2312-decoder"><span class="secno">10.2.1 </span><dfn>hz-gb-2312 decoder</dfn></h4>

<p><a href="#hz-gb-2312">hz-gb-2312</a>'s <a href="#decoder">decoder</a> has an associated
<dfn id="hz-gb-2312-flag">hz-gb-2312 flag</dfn> (initially unset) and
<dfn id="hz-gb-2312-lead">hz-gb-2312 lead</dfn> (initially 0x00).

<p><a href="#hz-gb-2312">hz-gb-2312</a>'s <a href="#decoder">decoder</a>'s <a href="#handler">handler</a>, given a
<var>stream</var> and <var title="">byte</var>, runs these steps:

<ol>
 <li><p>If <var title="">byte</var> is <a href="#end-of-stream">end-of-stream</a> and
 <a href="#hz-gb-2312-lead">hz-gb-2312 lead</a> is not 0x00, set <a href="#hz-gb-2312-lead">hz-gb-2312 lead</a> to 0x00 and
 return <a href="#error">error</a>.

 <li><p>If <var title="">byte</var> is <a href="#end-of-stream">end-of-stream</a> and
 <a href="#hz-gb-2312-lead">hz-gb-2312 lead</a> is 0x00, return <a href="#finished">finished</a>.

 <li>
  <p>If <a href="#hz-gb-2312-lead">hz-gb-2312 lead</a> is 0x7E, set
  <a href="#hz-gb-2312-lead">hz-gb-2312 lead</a> to 0x00, and based on <var title="">byte</var>:

  <dl class="switch">
   <dt>0x7B<!--{-->
   <dd><p>Set the <a href="#hz-gb-2312-flag">hz-gb-2312 flag</a> and return <a href="#continue">continue</a>.

   <dt>0x7D<!--}-->
   <dd><p>Unset the <a href="#hz-gb-2312-flag">hz-gb-2312 flag</a> and return <a href="#continue">continue</a>.
   <!--In "ASCII mode" IE outputs ~}, Gecko outputs U+FFFD, Chrome outputs
   a single U+FFFD for ~}~}. Weird. Opera just skips.-->

   <dt>0x7E<!--~-->
   <dd><p>Return code point U+007E.

   <dt>0x0A<!--newline-->
   <dd><p>Return <a href="#continue">continue</a>.

   <dt>Otherwise
   <dd><p><a href="#concept-stream-prepend" title="concept-stream-prepend">Prepend</a> <var title="">byte</var> to
   <var>stream</var> and return <a href="#error">error</a>.
  </dl>

 <li>
  <p>If <a href="#hz-gb-2312-lead">hz-gb-2312 lead</a> is not 0x00, let
  <var>lead</var> be <a href="#hz-gb-2312-lead">hz-gb-2312 lead</a>, set
  <a href="#hz-gb-2312-lead">hz-gb-2312 lead</a> to 0x00, and then run these substeps:

  <ol>
   <li><p>If <var title="">byte</var> is in the range 0x21 to 0x7E, let
   <var title="">code point</var> be the <a href="#index-code-point">index code point</a> for
   (<var>lead</var> âˆ’ 1) Ã— 190 + (<var title="">byte</var> + 0x3F)
   in <a href="#index-gb18030">index gb18030</a>.
   <!--lead-1    = lead+0x80-0x81
       byte+0x3F = byte+0x80-0x41-->

   <li><p>If <var title="">byte</var> is 0x0A, unset the <a href="#hz-gb-2312-flag">hz-gb-2312 flag</a>.

   <li><p>If <var title="">code point</var> is null, return <a href="#error">error</a>.

   <li><p>Return a code point whose value is <var title="">code point</var>.
  </ol>

 <li><p>If <var title="">byte</var> is 0x7E<!--~-->, set
 <a href="#hz-gb-2312-lead">hz-gb-2312 lead</a> to 0x7E and return <a href="#continue">continue</a>.

 <li>
  <p>If the <a href="#hz-gb-2312-flag">hz-gb-2312 flag</a> is set:

  <ol>
   <li><p>If <var title="">byte</var> is in the range 0x20 to 0x7F, set
   <a href="#hz-gb-2312-lead">hz-gb-2312 lead</a> to <var title="">byte</var> and return <a href="#continue">continue</a>.

   <li><p>If <var title="">byte</var> is 0x0A, unset the
   <a href="#hz-gb-2312-flag">hz-gb-2312 flag</a>.

   <li><p>Return <a href="#error">error</a>.
  </ol>

 <li><p>If <var title="">byte</var> is in the range 0x00 to 0x7F, return
 a code point whose value is <var title="">byte</var>.

 <li><p>Return <a href="#error">error</a>.
</ol>


<h4 id="hz-gb-2312-encoder"><span class="secno">10.2.2 </span><dfn>hz-gb-2312 encoder</dfn></h4>

<p><a href="#hz-gb-2312">hz-gb-2312</a>'s <a href="#encoder">encoder</a> has an associated
<a href="#hz-gb-2312-flag">hz-gb-2312 flag</a>.

<p><a href="#hz-gb-2312">hz-gb-2312</a>'s <a href="#encoder">encoder</a>'s <a href="#handler">handler</a>, given a
<var>stream</var> and <var title="">code point</var>, runs these steps:

<ol>
 <li><p>If <var title="">code point</var> is <a href="#end-of-stream">end-of-stream</a>, return
 <a href="#finished">finished</a>.

 <li><p>If <var title="">code point</var> is in the range U+0000 to U+007F and the
 <a href="#hz-gb-2312-flag">hz-gb-2312 flag</a> is set, <a href="#concept-stream-prepend" title="concept-stream-prepend">prepend</a>
 <var title="">code point</var> to <var>stream</var>, unset the <a href="#hz-gb-2312-flag">hz-gb-2312 flag</a>,
 and return two bytes 0x7E 0x7D.

 <li><p>If <var title="">code point</var> is 0x007E, return two bytes 0x7E 0x7E.

 <li><p>If <var title="">code point</var> is in the range U+0000 to U+007F, return
 a byte whose value is <var title="">code point</var>.

 <li><p>Let <var title="">pointer</var> be the <a href="#index-pointer">index pointer</a> for
 <var title="">code point</var> in <a href="#index-gb18030">index gb18030</a>.

 <li><p>If <var title="">pointer</var> is null, return <a href="#error">error</a> with
 <var title="">code point</var>.

 <li><p>If the <a href="#hz-gb-2312-flag">hz-gb-2312 flag</a> is unset,
 <a href="#concept-stream-prepend" title="concept-stream-prepend">prepend</a> <var title="">code point</var> to
 <var>stream</var>, set the <a href="#hz-gb-2312-flag">hz-gb-2312 flag</a>, and return two bytes 0x7E 0x7B.

 <li><p>Let <var>lead</var> be <var title="">pointer</var> / 190 + 1.

 <li><p>Let <var>trail</var> be <var title="">pointer</var> % 190 âˆ’ 0x3F.

 <li><p>If either <var>lead</var> or <var>trail</var> is less than
 0x21, return <a href="#error">error</a> with <var title="">code point</var>.
 <!-- 0x21 to 0x7E -->

 <li><p>Return two bytes whose values are <var>lead</var> and
 <var>trail</var>.
</ol>



<h2 id="legacy-multi-byte-chinese-(traditional)-encodings"><span class="secno">11 </span>Legacy multi-byte Chinese (traditional) encodings</h2>

<!--
 Lead:  0x81 to 0xFE
 Trail: 0x40 to 0x7E or 0xA1 to 0xFE
-->


<h3 id="big5"><span class="secno">11.1 </span><dfn>big5</dfn></h3>

<h4 id="big5-decoder"><span class="secno">11.1.1 </span><dfn>big5 decoder</dfn></h4>

<p><a href="#big5">big5</a>'s <a href="#decoder">decoder</a> has an associated
<dfn id="big5-lead">big5 lead</dfn> (initially 0x00).

<a href="#big5">big5</a>'s <a href="#decoder">decoder</a>'s <a href="#handler">handler</a>, given a
<var>stream</var> and <var title="">byte</var>, runs these steps:

<ol>
 <li><p>If <var title="">byte</var> is <a href="#end-of-stream">end-of-stream</a> and <a href="#big5-lead">big5 lead</a>
 is not 0x00, set <a href="#big5-lead">big5 lead</a> to 0x00 and return <a href="#error">error</a>.

 <li><p>If <var title="">byte</var> is <a href="#end-of-stream">end-of-stream</a> and <a href="#big5-lead">big5 lead</a>
 is 0x00, return <a href="#finished">finished</a>.

 <li>
  <p>If <a href="#big5-lead">big5 lead</a> is not 0x00, let <var>lead</var> be
  <a href="#big5-lead">big5 lead</a>, let <var title="">pointer</var> be null, set
  <a href="#big5-lead">big5 lead</a> to 0x00, and then run these substeps:

  <ol>
   <li><p>Let <var>offset</var> be 0x40 if <var title="">byte</var> is
   less than 0x7F and 0x62 otherwise.
   <!-- 0x62 = 0xA1-0x7E+1+0x40 -->

   <li><p>If <var title="">byte</var> is in the range 0x40 to 0x7E or
   0xA1 to 0xFE, set <var title="">pointer</var> to
   (<var>lead</var> âˆ’ 0x81) Ã— 157 + (<var title="">byte</var> âˆ’ <var>offset</var>).

   <li>
    <p>If there is a row in the table below whose first column is
    <var title="">pointer</var>, return the <em>two</em> code points listed in
    its second column (the third column is irrelevant):

    <table>
     <tr><th>Pointer<th>Code points<th>Notes<!-- http://www.unicode.org/Public/UNIDATA/NamedSequences.txt -->
     <tr><td>1133<!-- 0x88 0x62 --><td>U+00CA U+0304<td>ÃŠÌ„ (LATIN CAPITAL LETTER E WITH CIRCUMFLEX AND MACRON)
     <tr><td>1135<!-- 0x88 0x64 --><td>U+00CA U+030C<td>ÃŠÌŒ (LATIN CAPITAL LETTER E WITH CIRCUMFLEX AND CARON)
     <tr><td>1164<!-- 0x88 0xA3 --><td>U+00EA U+0304<td>ÃªÌ„ (LATIN SMALL LETTER E WITH CIRCUMFLEX AND MACRON)
     <tr><td>1166<!-- 0x88 0xA5 --><td>U+00EA U+030C<td>ÃªÌŒ (LATIN SMALL LETTER E WITH CIRCUMFLEX AND CARON)
    </table>
    <!-- we do this to avoid PUA -->

    <p class="note">Since <a href="#index" title="index">indexes</a> are limited to
    single code points this table is used for these pointers.

   <li><p>Let <var title="">code point</var> be null if
   <var title="">pointer</var> is null and the <a href="#index-code-point">index code point</a>
   for <var title="">pointer</var> in <a href="#index-big5">index big5</a> otherwise.

   <li><p>If <var title="">pointer</var> is null and <var title="">byte</var> is in the range
   0x00 to 0x7F, <a href="#concept-stream-prepend" title="concept-stream-prepend">prepend</a> <var title="">byte</var>
   to <var>stream</var>.

   <li><p>If <var title="">code point</var> is null, return <a href="#error">error</a>.

   <li><p>Return a code point whose value is <var title="">code point</var>.
  </ol>

 <li><p>If <var title="">byte</var> is in the range 0x00 to 0x7F, return
 a code point whose value is <var title="">byte</var>.

 <li><p>If <var title="">byte</var> is in the range 0x81 to 0xFE, set
 <a href="#big5-lead">big5 lead</a> to <var title="">byte</var> and return <a href="#continue">continue</a>.

 <li><p>Return <a href="#error">error</a>.
</ol>


<h4 id="big5-encoder"><span class="secno">11.1.2 </span><dfn>big5 encoder</dfn></h4>

<p><a href="#big5">big5</a>'s <a href="#encoder">encoder</a>'s <a href="#handler">handler</a>, given a
<var>stream</var> and <var title="">code point</var>, runs these steps:

<ol>
 <li><p>If <var title="">code point</var> is <a href="#end-of-stream">end-of-stream</a>, return
 <a href="#finished">finished</a>.

 <li><p>If <var title="">code point</var> is in the range U+0000 to U+007F, return
 a byte whose value is <var title="">code point</var>.

 <li><p>Let <var title="">pointer</var> be the <a href="#index-pointer">index pointer</a> for
 <var title="">code point</var> in <a href="#index-big5">index big5</a>.

 <li><p>If <var title="">pointer</var> is null, return <a href="#error">error</a> with
 <var title="">code point</var>.

 <li><p>Let <var>lead</var> be <var title="">pointer</var> / 157 + 0x81.

 <li>
  <p>If <var>lead</var> is less than 0xA1, return <a href="#error">error</a> with
  <var title="">code point</var>.

  <p class="note">Avoid returning Hong Kong Supplementary Character Set extensions
  literally.

 <li><p>Let <var>trail</var> be <var title="">pointer</var> % 157.

 <li><p>Let <var>offset</var> be 0x40 if <var>trail</var> is
 less than 0x3F<!--0x7F-0x40--> and 0x62<!--0xA1-0x3F--> otherwise.

 <li><p>Return two bytes whose values are <var>lead</var> and
 <var>trail</var> + <var>offset</var>.
</ol>



<h2 id="legacy-multi-byte-japanese-encodings"><span class="secno">12 </span>Legacy multi-byte Japanese encodings</h2>

<h3 id="euc-jp"><span class="secno">12.1 </span><dfn>euc-jp</dfn></h3>
<!-- http://www.iana.org/assignments/charset-reg/CP51932 -->

<h4 id="euc-jp-decoder"><span class="secno">12.1.1 </span><dfn>euc-jp decoder</dfn></h4>

<p><a href="#euc-jp">euc-jp</a>'s <a href="#decoder">decoder</a> has an associated
<dfn id="euc-jp-jis0212-flag">euc-jp jis0212 flag</dfn> (initially unset) and
<dfn id="euc-jp-lead">euc-jp lead</dfn> (initially 0x00).

<p><a href="#euc-jp">euc-jp</a>'s <a href="#decoder">decoder</a>'s <a href="#handler">handler</a>, given a
<var>stream</var> and <var title="">byte</var>, runs these steps:

<ol>
 <li><p>If <var title="">byte</var> is <a href="#end-of-stream">end-of-stream</a> and
 <a href="#euc-jp-lead">euc-jp lead</a> is not 0x00, set <a href="#euc-jp-lead">euc-jp lead</a> to 0x00, and return
 <a href="#error">error</a>.

 <li><p>If <var title="">byte</var> is <a href="#end-of-stream">end-of-stream</a> and
 <a href="#euc-jp-lead">euc-jp lead</a> is 0x00, return <a href="#finished">finished</a>.

 <li><p>If <a href="#euc-jp-lead">euc-jp lead</a> is 0x8E and <var title="">byte</var> is
 in the range 0xA1 to 0xDF, set <a href="#euc-jp-lead">euc-jp lead</a> to 0x00 and return
 a code point whose value is 0xFF61 + <var title="">byte</var> âˆ’ 0xA1.
 <!-- katakana -->

 <li><p>If <a href="#euc-jp-lead">euc-jp lead</a> is 0x8F and <var title="">byte</var> is in the range
 0xA1 to 0xFE, set the <a href="#euc-jp-jis0212-flag">euc-jp jis0212 flag</a>, set <a href="#euc-jp-lead">euc-jp lead</a> to
 <var title="">byte</var>, and return <a href="#continue">continue</a>.

 <li>
  <p>If <a href="#euc-jp-lead">euc-jp lead</a> is not 0x00, let <var>lead</var> be
  <a href="#euc-jp-lead">euc-jp lead</a>, set <a href="#euc-jp-lead">euc-jp lead</a> to 0x00, and run these substeps:

  <ol>
   <li><p>Let <var title="">code point</var> be null.

   <li><p>If <var>lead</var> and <var title="">byte</var> are both in the
   range 0xA1 to 0xFE, set <var title="">code point</var> to the
   <a href="#index-code-point">index code point</a> for
   (<var>lead</var> âˆ’ 0xA1) Ã— 94 + <var title="">byte</var> âˆ’ 0xA1
   in <a href="#index-jis0208">index jis0208</a> if the <a href="#euc-jp-jis0212-flag">euc-jp jis0212 flag</a> is unset and in
   <a href="#index-jis0212">index jis0212</a> otherwise.

   <li><p>Unset the <a href="#euc-jp-jis0212-flag">euc-jp jis0212 flag</a>.

   <li><p>If <var title="">byte</var> is not in the range 0xA1 to 0xFE,
   <a href="#concept-stream-prepend" title="concept-stream-prepend">prepend</a> <var title="">byte</var> to
   <var>stream</var>.

   <li><p>If <var title="">code point</var> is null, return <a href="#error">error</a>.

   <li><p>Return a code point whose value is <var title="">code point</var>.
  </ol>

 <li><p>If <var title="">byte</var> is in the range 0x00 to 0x7F, return
 a code point whose value is <var title="">byte</var>.

 <li><p>If <var title="">byte</var> is 0x8E, 0x8F, or in the range 0xA1 to
 0xFE, set <a href="#euc-jp-lead">euc-jp lead</a> to <var title="">byte</var> and return
 <a href="#continue">continue</a>.

 <li><p>Return <a href="#error">error</a>.
</ol>


<h4 id="euc-jp-encoder"><span class="secno">12.1.2 </span><dfn>euc-jp encoder</dfn></h4>

<p><a href="#euc-jp">euc-jp</a>'s <a href="#encoder">encoder</a>'s <a href="#handler">handler</a>, given a
<var>stream</var> and <var title="">code point</var>, runs these steps:

<ol>
 <li><p>If <var title="">code point</var> is <a href="#end-of-stream">end-of-stream</a>, return
 <a href="#finished">finished</a>.

 <li><p>If <var title="">code point</var> is in the range U+0000 to U+007F, return
 a byte whose value is <var title="">code point</var>.

 <li><p>If <var title="">code point</var> is U+00A5, return byte 0x5C.

 <li><p>If <var title="">code point</var> is U+203E, return byte 0x7E.

 <li><p>If <var title="">code point</var> is in the range U+FF61 to U+FF9F, return
 two bytes whose values are 0x8E and <var title="">code point</var> âˆ’ 0xFF61 + 0xA1.

 <li><p>Let <var title="">pointer</var> be the <a href="#index-pointer">index pointer</a> for
 <var title="">code point</var> in <a href="#index-jis0208">index jis0208</a>.

 <li><p>If <var title="">pointer</var> is null, return <a href="#error">error</a> with
 <var title="">code point</var>.

 <li><p>Let <var>lead</var> be <var title="">pointer</var> / 94 + 0xA1.

 <li><p>Let <var>trail</var> be <var title="">pointer</var> % 94 + 0xA1.

 <li><p>Return two bytes whose values are <var>lead</var> and
 <var>trail</var>.
</ol>

<p class="note">The <a href="#index-jis0212">index jis0212</a> is not used by the
<a href="#euc-jp-encoder">euc-jp encoder</a> due to lack of widespread support.

<!--
 No JIX X 0212 encoder support:
   https://bugzilla.mozilla.org/show_bug.cgi?id=600715
   http://code.google.com/p/chromium/issues/detail?id=78847
-->


<h3 id="iso-2022-jp"><span class="secno">12.2 </span><dfn>iso-2022-jp</dfn></h3>
<!--
 http://tools.ietf.org/html/rfc1468
 http://tools.ietf.org/html/rfc2237 (iso-2022-jp-1)
-->

<h4 id="iso-2022-jp-decoder"><span class="secno">12.2.1 </span><dfn>iso-2022-jp decoder</dfn></h4>

<p><a href="#iso-2022-jp">iso-2022-jp</a>'s <a href="#decoder">decoder</a> has an associated
<dfn id="iso-2022-jp-state">iso-2022-jp state</dfn> (initially <b title="">ASCII state</b>),
<dfn id="iso-2022-jp-jis0212-flag">iso-2022-jp jis0212 flag</dfn> (initially unset), and
<dfn id="iso-2022-jp-lead">iso-2022-jp lead</dfn> (initially 0x00).

<p><a href="#iso-2022-jp">iso-2022-jp</a>'s <a href="#decoder">decoder</a>'s <a href="#handler">handler</a>, given a
<var>stream</var> and <var title="">byte</var>, runs these steps, switching on
<a href="#iso-2022-jp-state">iso-2022-jp state</a>:

<dl class="switch">
 <dt><b title="">ASCII state</b>

 <dd>
  <p>Based on <var title="">byte</var>:

  <dl class="switch">
   <dt>0x1B
   <dd><p>Set <a href="#iso-2022-jp-state">iso-2022-jp state</a> to <b>escape start state</b> and return
   <a href="#continue">continue</a>.

   <dt>0x00 to 0x7F
   <dd><p>Return a code point whose value is <var title="">byte</var>.

   <dt><a href="#end-of-stream">end-of-stream</a>
   <dd><p>Return <a href="#finished">finished</a>.

   <dt>Otherwise
   <dd><p>Return <a href="#error">error</a>.
  </dl>

 <dt><b>Escape start state</b>
 <dd>
  <ol>
   <li><p>If <var title="">byte</var> is either <!--$-->0x24 or <!--(-->0x28, set
   <a href="#iso-2022-jp-lead">iso-2022-jp lead</a> to <var title="">byte</var>, <a href="#iso-2022-jp-state">iso-2022-jp state</a>
   to <b title="">escape middle state</b>, and return <a href="#continue">continue</a>.

   <li><p>If <var title="">byte</var> is not <a href="#end-of-stream">end-of-stream</a>,
   <a href="#concept-stream-prepend" title="concept-stream-prepend">prepend</a> <var title="">byte</var> to
   <var>stream</var>.

   <li><p>Set <a href="#iso-2022-jp-state">iso-2022-jp state</a> to <b title="">ASCII state</b> and return
   <a href="#error">error</a>.
  </ol>

 <dt><b>Escape middle state</b>
 <dd>
  <ol>
   <li><p>Let <var>lead</var> be <a href="#iso-2022-jp-lead">iso-2022-jp lead</a> and set
   <a href="#iso-2022-jp-lead">iso-2022-jp lead</a> to 0x00.

   <li><p>If <var>lead</var> is 0x24 and <var title="">byte</var> is either
   0x40<!--@--> or 0x42<!--B-->, unset the <a href="#iso-2022-jp-jis0212-flag">iso-2022-jp jis0212 flag</a>, set
   <a href="#iso-2022-jp-state">iso-2022-jp state</a> to <b title="">lead state</b>, and return
   <a href="#continue">continue</a>.

   <li><p>If <var>lead</var> is 0x24 and <var title="">byte</var> is 0x28, set
   <a href="#iso-2022-jp-state">iso-2022-jp state</a> to <b title="">escape final state</b> and return
   <a href="#continue">continue</a>.

   <li><p>If <var>lead</var> is 0x28 and <var title="">byte</var> is either
   0x42<!--B--> or 0x4A<!--J-->, set <a href="#iso-2022-jp-state">iso-2022-jp state</a> to
   <b title="">ASCII state</b> and return <a href="#continue">continue</a>.

   <li><p>If <var>lead</var> is 0x28 and <var title="">byte</var> is 0x49<!--I-->, set
   <a href="#iso-2022-jp-state">iso-2022-jp state</a> to <b title="">Katakana state</b> and return
   <a href="#continue">continue</a>.

   <li><p>Let <var>buffer</var> be <var title="">byte</var> if <var title="">byte</var> is
   <a href="#end-of-stream">end-of-stream</a>, and two bytes <var>lead</var> <var title="">byte</var>
   otherwise.

   <li><p><a href="#concept-stream-prepend" title="concept-stream-prepend">Prepend</a> <var>buffer</var> to
   <var>stream</var>.

   <li><p>Set <a href="#iso-2022-jp-state">iso-2022-jp state</a> to <b title="">ASCII state</b> and return
   <a href="#error">error</a>.
  </ol>

 <dt><b>Escape final state</b>
 <dd>
  <ol>
   <li><p>If <var title="">byte</var> is 0x44<!--D-->, set the
   <a href="#iso-2022-jp-jis0212-flag">iso-2022-jp jis0212 flag</a>, set <a href="#iso-2022-jp-state">iso-2022-jp state</a> to
   <b title="">lead state</b>, and return <a href="#continue">continue</a>.

   <li><p>Let <var title="">buffer</var> be two bytes 0x28 <var title="">byte</var>, if
   <var title="">byte</var> is <a href="#end-of-stream">end-of-stream</a>, and three bytes
   0x24 0x28 <var title="">byte</var> otherwise.

   <li><p><a href="#concept-stream-prepend" title="concept-stream-prepend">Prepend</a> <var>buffer</var> to
   <var>stream</var>.

   <li><p>Set <a href="#iso-2022-jp-state">iso-2022-jp state</a> to <b title="">ASCII state</b> and return
   <a href="#error">error</a>.
  </ol>

 <dt><b>Lead state</b>
 <dd>
  <p>Based on <var title="">byte</var>:
  <dl class="switch">
   <dt>0x0A
   <dd><p>Set <a href="#iso-2022-jp-state">iso-2022-jp state</a> to <b title="">ASCII state</b> and return
   code point U+000A.

   <dt>0x1B
   <dd><p>Set <a href="#iso-2022-jp-state">iso-2022-jp state</a> to <b title="">escape start state</b> and return
   <a href="#continue">continue</a>.

   <dt><a href="#end-of-stream">end-of-stream</a>
   <dd><p>Return <a href="#finished">finished</a>.

   <dt>Otherwise
   <dd><p>Set <a href="#iso-2022-jp-lead">iso-2022-jp lead</a> to <var title="">byte</var>,
   <a href="#iso-2022-jp-state">iso-2022-jp state</a> to <b title="">trail state</b>, and return
   <a href="#continue">continue</a>.
  </dl>

 <dt>Trail state
 <dd>
  <ol>
   <li><p>Set the <a href="#iso-2022-jp-state">iso-2022-jp state</a> to <b title="">lead state</b>.

   <li><p>If <var title="">byte</var> is <a href="#end-of-stream">end-of-stream</a>, return
   <a href="#error">error</a>.

   <li><p>Let <var title="">code point</var> be null and let <var title="">pointer</var> be
   (<a href="#iso-2022-jp-lead">iso-2022-jp lead</a> âˆ’ 0x21) Ã— 94 + <var title="">byte</var> âˆ’ 0x21.

   <li><p>If <a href="#iso-2022-jp-lead">iso-2022-jp lead</a> and <var title="">byte</var> are both in the range
   0x21 to 0x7E, set <var title="">code point</var> to the <a href="#index-code-point">index code point</a> for
   <var title="">pointer</var> in <a href="#index-jis0208">index jis0208</a>, if the
   <a href="#iso-2022-jp-jis0212-flag">iso-2022-jp jis0212 flag</a> is unset, and in <a href="#index-jis0212">index jis0212</a>
   otherwise.

   <li><p>If <var title="">code point</var> is null, return <a href="#error">error</a>.

   <li><p>Return a code point whose value is <var title="">code point</var>.
  </ol>

 <dt><b>Katakana state</b>
 <dd>
  <p>Based on <var title="">byte</var>:
  <dl class="switch">
   <dt>0x1B
   <dd><p>Set <a href="#iso-2022-jp-state">iso-2022-jp state</a> to <b title="">escape start state</b> and return
   <a href="#continue">continue</a>.

   <dt>0x21 to 0x5F
   <dd><p>Return a code point whose value is 0xFF61 + <var title="">byte</var> âˆ’ 0x21.
   <!-- katakana -->

   <dt><a href="#end-of-stream">end-of-stream</a>
   <dd><p>Return <a href="#finished">finished</a>.

   <dt>Otherwise
   <dd><p>Return <a href="#error">error</a>.
  </dl>
</dl>


<h4 id="iso-2022-jp-encoder"><span class="secno">12.2.2 </span><dfn>iso-2022-jp encoder</dfn></h4>

<p><a href="#iso-2022-jp">iso-2022-jp</a>'s <a href="#encoder">encoder</a> has an associated
<a href="#iso-2022-jp-state">iso-2022-jp state</a>.

<p><a href="#iso-2022-jp">iso-2022-jp</a>'s <a href="#encoder">encoder</a>'s <a href="#handler">handler</a>, given a
<var>stream</var> and <var title="">code point</var>, runs these steps:

<ol>
 <li><p>If <var title="">code point</var> is <a href="#end-of-stream">end-of-stream</a>, return
 <a href="#finished">finished</a>.

 <li><p>If <var title="">code point</var> is in the range U+0000 to U+007F, or
 is U+00A5 or U+203E, and <a href="#iso-2022-jp-state">iso-2022-jp state</a> is not
 <b title="">ASCII state</b>, <a href="#concept-stream-prepend" title="concept-stream-prepend">prepend</a>
 <var title="">code point</var> to <var>stream</var>, set <a href="#iso-2022-jp-state">iso-2022-jp state</a> to
 <b title="">ASCII state</b>, and return three bytes 0x1B 0x28 0x42.

 <li><p>If <var title="">code point</var> is in the range U+0000 to U+007F, return
 a byte whose value is <var title="">code point</var>.

 <li><p>If <var title="">code point</var> is U+00A5, return byte 0x5C.

 <li><p>If <var title="">code point</var> is U+203E, return byte 0x7E.

 <li><p>If <var title="">code point</var> is in the range U+FF61 to U+FF9F and
 <a href="#iso-2022-jp-state">iso-2022-jp state</a> is not <b title="">Katakana state</b>,
 <a href="#concept-stream-prepend" title="concept-stream-prepend">prepend</a> <var title="">code point</var> to
 <var>stream</var>, set <a href="#iso-2022-jp-state">iso-2022-jp state</a> to <b title="">Katakana state</b>, and
 return three bytes 0x1B 0x28 0x49.

 <li><p>If <var title="">code point</var> is in the range U+FF61 to U+FF9F, return
 a byte whose value is <var title="">code point</var> âˆ’ 0xFF61 + 0x21.

 <li><p>Let <var title="">pointer</var> be the <a href="#index-pointer">index pointer</a> for
 <var title="">code point</var> in <a href="#index-jis0208">index jis0208</a>.

 <li><p>If <var title="">pointer</var> is null, return <a href="#error">error</a> with
 <var title="">code point</var>.

 <li><p>If <a href="#iso-2022-jp-state">iso-2022-jp state</a> is not <b title="">lead state</b>,
 <a href="#concept-stream-prepend" title="concept-stream-prepend">prepend</a> <var title="">code point</var> to
 <var>stream</var>, set <a href="#iso-2022-jp-state">iso-2022-jp state</a> to <b title="">lead state</b>, and
 return three bytes 0x1B 0x24 0x42.

 <li><p>Let <var>lead</var> be <var title="">pointer</var> / 94 + 0x21.

 <li><p>Let <var>trail</var> be <var title="">pointer</var> % 94 + 0x21.

 <li><p>Return two bytes whose values are <var>lead</var> and
 <var>trail</var>.
</ol>

<p class="note">The <a href="#index-jis0212">index jis0212</a> is not used by the
<a href="#iso-2022-jp-encoder">iso-2022-jp encoder</a> due to lack of widespread support.


<h3 id="shift_jis"><span class="secno">12.3 </span><dfn>shift_jis</dfn></h3>

<h4 id="shift_jis-decoder"><span class="secno">12.3.1 </span><dfn>shift_jis decoder</dfn></h4>

<p><a href="#shift_jis">shift_jis</a>'s <a href="#decoder">decoder</a> has an associated
<dfn id="shift_jis-lead">shift_jis lead</dfn> (initially 0x00).

<p><a href="#shift_jis">shift_jis</a>'s <a href="#decoder">decoder</a>'s <a href="#handler">handler</a>, given a
<var>stream</var> and <var title="">byte</var>, runs these steps:

<ol>
 <li><p>If <var title="">byte</var> is <a href="#end-of-stream">end-of-stream</a>,
 <a href="#shift_jis-lead">shift_jis lead</a> is not 0x00, set <a href="#shift_jis-lead">shift_jis lead</a> to 0x00 and
 return <a href="#error">error</a>.

 <li><p>If <var title="">byte</var> is <a href="#end-of-stream">end-of-stream</a> and
 <a href="#shift_jis-lead">shift_jis lead</a> is 0x00, return <a href="#finished">finished</a>.

 <li>
  <p>If <a href="#shift_jis-lead">shift_jis lead</a> is not 0x00, let <var>lead</var>
  be <a href="#shift_jis-lead">shift_jis lead</a>, let <var title="">pointer</var> be null, set
  <a href="#shift_jis-lead">shift_jis lead</a> to 0x00, and then run these substeps:

  <ol>
   <li><p>Let <var>offset</var> be 0x40, if <var title="">byte</var> is
   less than 0x7F, and 0x41 otherwise.

   <li><p>If <var>lead</var> is in the range 0xF0 to 0xF9, return
   a code point whose value is
   0xE000 + (<var>lead</var> âˆ’ 0xF0) Ã— 188 + <var title="">byte</var> âˆ’ <var>offset</var>.
   <!-- EUDC / PUA -->

   <li><p>Let <var>lead offset</var> be 0x81, if <var>lead</var>
   is less than 0xA0, and 0xC1 otherwise.

   <li><p>If <var title="">byte</var> is in the range 0x40 to 0x7E or
   0x80 to 0xFC, set <var title="">pointer</var> to
   (<var>lead</var> âˆ’ <var>lead offset</var>) Ã— 188 + <var title="">byte</var> âˆ’ <var>offset</var>.

   <li><p>Let <var title="">code point</var> be null, if
   <var title="">pointer</var> is null, and the <a href="#index-code-point">index code point</a>
   for <var title="">pointer</var> in <a href="#index-jis0208">index jis0208</a> otherwise.

   <li><p>If <var title="">pointer</var> is null,
   <a href="#concept-stream-prepend" title="concept-stream-prepend">prepend</a> <var title="">byte</var> to
   <var>stream</var>.

   <li><p>If <var title="">code point</var> is null, return <a href="#error">error</a>.

   <li><p>Return a code point whose value is <var title="">code point</var>.
  </ol>

 <li><p>If <var title="">byte</var> is in the range 0x00 to 0x80, return
 a code point whose value is <var title="">byte</var>.
 <!-- Opera has 0x7E -->

 <li><p>If <var title="">byte</var> is in the range 0xA1 to 0xDF, return
 a code point whose value is 0xFF61 + <var title="">byte</var> âˆ’ 0xA1.
 <!-- katakana -->

 <li><p>If <var title="">byte</var> is in the range 0x81 to 0x9F or 0xE0 to 0xFC, set
 <a href="#shift_jis-lead">shift_jis lead</a> to <var title="">byte</var> and return <a href="#continue">continue</a>.

 <li><p>Return <a href="#error">error</a>.
</ol>


<h4 id="shift_jis-encoder"><span class="secno">12.3.2 </span><dfn>shift_jis encoder</dfn></h4>

<p><a href="#shift_jis">shift_jis</a>'s <a href="#encoder">encoder</a>'s <a href="#handler">handler</a>, given a
<var>stream</var> and <var title="">code point</var>, runs these steps:

<ol>
 <li><p>If <var title="">code point</var> is <a href="#end-of-stream">end-of-stream</a>, return
 <a href="#finished">finished</a>.

 <li><p>If <var title="">code point</var> is in the range U+0000 to U+0080, return
 a byte whose value is <var title="">code point</var>.

 <li><p>If <var title="">code point</var> is U+00A5, return byte 0x5C.

 <li><p>If <var title="">code point</var> is U+203E, return byte 0x7E.

 <li><p>If <var title="">code point</var> is in the range U+FF61 to U+FF9F, return
 a byte whose value is <var title="">code point</var> âˆ’ 0xFF61 + 0xA1.

 <li><p>Let <var title="">pointer</var> be the <a href="#index-shift_jis-pointer">index shift_jis pointer</a> for
 <var title="">code point</var>.

 <li><p>If <var title="">pointer</var> is null, return <a href="#error">error</a> with
 <var title="">code point</var>.

 <li><p>Let <var>lead</var> be <var title="">pointer</var> / 188.

 <li><p>Let <var>lead offset</var> be 0x81, if <var>lead</var> is
 less than 0x1F, and 0xC1 otherwise.
 <!-- 0xA0-0x81 -->

 <li><p>Let <var>trail</var> be <var title="">pointer</var> % 188.

 <li><p>Let <var>offset</var> be 0x40, if <var>trail</var> is
 less than 0x3F, and 0x41 otherwise.

 <li><p>Return two bytes whose values are
 <var>lead</var> + <var>lead offset</var> and
 <var>trail</var> + <var>offset</var>.
</ol>



<h2 id="legacy-multi-byte-korean-encodings"><span class="secno">13 </span>Legacy multi-byte Korean encodings</h2>

<h3 id="euc-kr"><span class="secno">13.1 </span><dfn>euc-kr</dfn></h3>

<h4 id="euc-kr-decoder"><span class="secno">13.1.1 </span><dfn>euc-kr decoder</dfn></h4>

<p><a href="#euc-kr">euc-kr</a>'s <a href="#decoder">decoder</a> has an associated
<dfn id="euc-kr-lead">euc-kr lead</dfn> (initially 0x00).

<p><a href="#euc-kr">euc-kr</a>'s <a href="#decoder">decoder</a>'s <a href="#handler">handler</a>, given a
<var>stream</var> and <var title="">byte</var>, runs these steps:

<ol>
 <li><p>If <var title="">byte</var> is <a href="#end-of-stream">end-of-stream</a> and
 <a href="#euc-kr-lead">euc-kr lead</a> is not 0x00, set <a href="#euc-kr-lead">euc-kr lead</a> to 0x00
 and return <a href="#error">error</a>.

 <li><p>If <var title="">byte</var> is <a href="#end-of-stream">end-of-stream</a> and
 <a href="#euc-kr-lead">euc-kr lead</a> is 0x00, return <a href="#finished">finished</a>.

 <li>
  <p>If <a href="#euc-kr-lead">euc-kr lead</a> is not 0x00, let <var>lead</var> be
  <a href="#euc-kr-lead">euc-kr lead</a>, let <var title="">pointer</var> be null,
  set <a href="#euc-kr-lead">euc-kr lead</a> to 0x00, and then run these substeps:

  <ol>
   <li>
    <p>If <var>lead</var> is in the range 0x81 to 0xC6, let
    <var title="">temp</var> be
    (26 + 26 + 126) Ã— (<var>lead</var> âˆ’ 0x81), and then
    set <var title="">pointer</var> to the result of the equation below,
    depending on <var title="">byte</var>:

    <dl class="switch">
     <dt>0x41 to 0x5A
     <dd><p><var title="">temp</var> + <var title="">byte</var> âˆ’ 0x41
     <dt>0x61 to 0x7A
     <dd><p><var title="">temp</var> + 26 + <var title="">byte</var> âˆ’ 0x61
     <dt>0x81 to 0xFE
     <dd><p><var title="">temp</var> + 26 + 26 + <var title="">byte</var> âˆ’ 0x81
    </dl>

   <li><p>If <var>lead</var> is in the range 0xC7 to 0xFE and
   <var title="">byte</var> is in the range 0xA1 to 0xFE, set
   <var title="">pointer</var> to
   (26 + 26 + 126) Ã— (0xC7 âˆ’ 0x81) + (<var>lead</var> âˆ’ 0xC7) Ã— 94 + (<var title="">byte</var> âˆ’ 0xA1).

   <li><p>Let <var title="">code point</var> be null, if
   <var title="">pointer</var> is null, and the
   <a href="#index-code-point">index code point</a> for <var title="">pointer</var> in
   <a href="#index-euc-kr">index euc-kr</a> otherwise.

   <li><p>If <var title="">pointer</var> is null,
   <a href="#concept-stream-prepend" title="concept-stream-prepend">prepend</a> <var title="">byte</var> to
   <var>stream</var>.

   <li><p>If <var title="">code point</var> is null, return <a href="#error">error</a>.

   <li><p>Return a code point whose value is <var title="">code point</var>.
  </ol>

 <li><p>If <var title="">byte</var> is in the range 0x00 to 0x7F, return
 a code point whose value is <var title="">byte</var>.

 <li><p>If <var title="">byte</var> is in the range 0x81 to 0xFE, set
 <a href="#euc-kr-lead">euc-kr lead</a> to <var title="">byte</var> and return <a href="#continue">continue</a>.

 <li><p>Return <a href="#error">error</a>.
</ol>


<h4 id="euc-kr-encoder"><span class="secno">13.1.2 </span><dfn>euc-kr encoder</dfn></h4>

<p><a href="#euc-kr">euc-kr</a>'s <a href="#encoder">encoder</a>'s <a href="#handler">handler</a>, given a
<var>stream</var> and <var title="">code point</var>, runs these steps:

<ol>
 <li><p>If <var title="">code point</var> is <a href="#end-of-stream">end-of-stream</a>, return
 <a href="#finished">finished</a>.

 <li><p>If <var title="">code point</var> is in the range U+0000 to U+007F, return
 a byte whose value is <var title="">code point</var>.

 <li><p>Let <var title="">pointer</var> be the <a href="#index-pointer">index pointer</a> for
 <var title="">code point</var> in <a href="#index-euc-kr">index euc-kr</a>.

 <li><p>If <var title="">pointer</var> is null, return <a href="#error">error</a> with
 <var title="">code point</var>.

 <li>
  <p>If <var title="">pointer</var> is less than
  (26 + 26 + 126) Ã— (0xC7 âˆ’ 0x81), run these substeps:

  <ol>
   <li><p>Let <var>lead</var> be
   <var title="">pointer</var> / (26 + 26 + 126) + 0x81.

   <li><p>Let <var>trail</var> be
   <var title="">pointer</var> % (26 + 26 + 126).

   <li><p>Let <var>offset</var> be 0x41 if <var>trail</var> is
   less than 26, 0x47 if <var>trail</var> is less than 26 + 26, and
   0x4D otherwise.
   <!-- 0x47=0x41+0x61-0x5A-1
        0x4D=0x47+0x81-0x7A-1 -->

   <li><p>Return two bytes whose values are <var>lead</var> and
   <var>trail</var> + <var>offset</var>.
  </ol>

 <li><p>Set <var title="">pointer</var> to
 <var title="">pointer</var> âˆ’ (26 + 26 + 126) Ã— (0xC7 âˆ’ 0x81).

 <li><p>Let <var>lead</var> be <var title="">pointer</var> / 94 + 0xC7.

 <li><p>Let <var>trail</var> be <var title="">pointer</var> % 94 + 0xA1.

 <li><p>Return two bytes whose values are <var>lead</var> and
 <var>trail</var>.
</ol>



<h2 id="legacy-miscellaneous-encodings"><span class="secno">14 </span>Legacy miscellaneous encodings</h2>

<h3 id="replacement"><span class="secno">14.1 </span><dfn>replacement</dfn></h3>

<p class="note">The <a href="#replacement">replacement</a> <a href="#encoding">encoding</a> exists to prevent certain
attacks that abuse a mismatch between <a href="#encoding" title="encoding">encodings</a> supported on
the server and the client.


<h4 id="replacement-decoder"><span class="secno">14.1.1 </span><dfn>replacement decoder</dfn></h4>

<p><a href="#replacement">replacement</a>'s <a href="#decoder">decoder</a> has an associated
<dfn id="replacement-error-returned-flag">replacement error returned flag</dfn> (initially unset).

<p><a href="#replacement">replacement</a>'s <a href="#decoder">decoder</a>'s <a href="#handler">handler</a>, given a
<var>stream</var> and <var title="">byte</var>, runs these steps:

<ol>
 <li><p>If <a href="#replacement-error-returned-flag">replacement error returned flag</a> is unset, set the
 <a href="#replacement-error-returned-flag">replacement error returned flag</a> and return <a href="#error">error</a>.

 <li><p>Return <a href="#finished">finished</a>.
</ol>

<h4 id="replacement-encoder"><span class="secno">14.1.2 </span><dfn>replacement encoder</dfn></h4>

<p><a href="#replacement">replacement</a>'s <a href="#encoder">encoder</a> is <a href="#utf-8">utf-8</a>'s
<a href="#encoder">encoder</a>.


<h3 id="common-infrastructure-for-utf-16be-and-utf-16le"><span class="secno">14.2 </span>Common infrastructure for <a href="#utf-16be">utf-16be</a> and <a href="#utf-16le">utf-16le</a></h3>

<p class="note">In violation of the Unicode standard, which does not allow for handling a
byte order mark in its definition of utf-16be and utf-16le, checking and using a
byte order mark happens before an encoding to decode a byte stream is chosen, as seen in
the <a href="#decode">decode</a> algorithm.

<p>To <dfn id="convert-a-code-unit-to-bytes">convert a <var title="">code unit</var> to bytes</dfn> using a
<i title="">utf-16be flag</i>, run these steps:

<ol>
 <li><p>Let <var title="">byte1</var> be <var title="">code unit</var> &gt;&gt; 8.

 <li><p>Let <var title="">byte2</var> be
 <var title="">code unit</var> &amp; 0x00FF.

 <li>
  <p>Then return the bytes in order:

  <dl class="switch">
   <dt><i title="">utf-16be flag</i> is set
   <dd><p><var title="">byte1</var>, then <var title="">byte2</var>.
   <dt><i title="">utf-16be flag</i> is unset
   <dd><p><var title="">byte2</var>, then <var title="">byte1</var>.
  </dl>
</ol>

<h4 id="shared-utf-16-decoder"><span class="secno">14.2.1 </span><dfn>shared utf-16 decoder</dfn></h4>

<p><a href="#shared-utf-16-decoder">shared utf-16 decoder</a> has an associated <dfn id="utf-16-lead-byte">utf-16 lead byte</dfn> and
<dfn id="utf-16-lead-surrogate">utf-16 lead surrogate</dfn> (both initially null), and
<dfn id="utf-16be-flag">utf-16be flag</dfn> (no initial value).

<p><a href="#shared-utf-16-decoder">shared utf-16 decoder</a>'s <a href="#handler">handler</a>, given a <var>stream</var>
and <var title="">byte</var>, runs these steps:

<ol>
 <li><p>If <var title="">byte</var> is <a href="#end-of-stream">end-of-stream</a> and either
 <a href="#utf-16-lead-byte">utf-16 lead byte</a> or <a href="#utf-16-lead-surrogate">utf-16 lead surrogate</a> is not null, set
 <a href="#utf-16-lead-byte">utf-16 lead byte</a> and <a href="#utf-16-lead-surrogate">utf-16 lead surrogate</a> to null, and return
 <a href="#error">error</a>.

 <li><p>If <var title="">byte</var> is <a href="#end-of-stream">end-of-stream</a> and
 <a href="#utf-16-lead-byte">utf-16 lead byte</a> and <a href="#utf-16-lead-surrogate">utf-16 lead surrogate</a> are null, return
 <a href="#finished">finished</a>.

 <li><p>If <a href="#utf-16-lead-byte">utf-16 lead byte</a> is null, set <a href="#utf-16-lead-byte">utf-16 lead byte</a> to
 <var title="">byte</var> and return <a href="#continue">continue</a>.

 <li>
  <p>Let <var title="">code point</var> be the result of:

  <dl class="switch">
   <dt><a href="#utf-16be-flag">utf-16be flag</a> is set
   <dd><p>(<a href="#utf-16-lead-byte">utf-16 lead byte</a> &lt;&lt; 8) + <var title="">byte</var>.
   <dt><a href="#utf-16be-flag">utf-16be flag</a> is unset
   <dd><p>(<var title="">byte</var> &lt;&lt; 8) + <a href="#utf-16-lead-byte">utf-16 lead byte</a>.
  </dl>

  <p>Then set <a href="#utf-16-lead-byte">utf-16 lead byte</a> to null.

 <li>
  <p>If <a href="#utf-16-lead-surrogate">utf-16 lead surrogate</a> is not null, let
  <var>lead surrogate</var> be <a href="#utf-16-lead-surrogate">utf-16 lead surrogate</a>, set
  <a href="#utf-16-lead-surrogate">utf-16 lead surrogate</a> to null, and then run these substeps:

  <ol>
   <li><p>If <var title="">code point</var> is in the range U+DC00 to U+DFFF, return
   a code point whose value is
   0x10000 + ((<var>lead surrogate</var> âˆ’ 0xD800) &lt;&lt; 10) + (<var title="">code point</var> âˆ’ 0xDC00).

   <li><p><a href="#concept-stream-prepend" title="concept-stream-prepend">Prepend</a> the sequence resulting of
   <a href="#convert-a-code-unit-to-bytes" title="convert a code unit to bytes">converting <var title="">code point</var> to bytes</a>
   using <a href="#utf-16be-flag">utf-16be flag</a> to <var>stream</var> and return <a href="#error">error</a>.
   <!-- unpaired surrogates; IE/WebKit output them, Gecko/Opera FFFD them -->
  </ol>

 <li><p>If <var title="">code point</var> is in the range U+D800 to U+DBFF, set
 <a href="#utf-16-lead-surrogate">utf-16 lead surrogate</a> to <var title="">code point</var> and return
 <a href="#continue">continue</a>.

 <li><p>If <var title="">code point</var> is in the range U+DC00 to U+DFFF,
 return <a href="#error">error</a>.
 <!-- unpaired surrogates; IE/WebKit output them, Gecko/Opera FFFD them -->

 <li><p>Return code point <var title="">code point</var>.
</ol>


<h4 id="shared-utf-16-encoder"><span class="secno">14.2.2 </span><dfn>shared utf-16 encoder</dfn></h4>

<p><a href="#shared-utf-16-encoder">shared utf-16 encoder</a> has an associated <a href="#utf-16be-flag">utf-16be flag</a>.

<p><a href="#shared-utf-16-encoder">shared utf-16 encoder</a>'s <a href="#handler">handler</a>, given a <var>stream</var>
and <var title="">code point</var>, runs these steps:

<ol>
 <li><p>If <var title="">code point</var> is <a href="#end-of-stream">end-of-stream</a>, return
 <a href="#finished">finished</a>.

 <li><p>If <var title="">code point</var> is in the range 0x00 to 0xFFFF, return the sequence
 resulting of
 <a href="#convert-a-code-unit-to-bytes" title="convert a code unit to bytes">converting <var title="">code point</var> to bytes</a>
 using <a href="#utf-16be-flag">utf-16be flag</a>.

 <li><p>Let <var>lead</var> be
 ((<var title="">code point</var> âˆ’ 0x10000) &gt;&gt; 10) + 0xD800,
 <a href="#convert-a-code-unit-to-bytes" title="convert a code unit to bytes">converted to bytes</a> using
 <a href="#utf-16be-flag">utf-16be flag</a>.

 <li><p>Let <var>trail</var> be
 ((<var title="">code point</var> âˆ’ 0x10000) &amp; 0x3FF) + 0xDC00,
 <a href="#convert-a-code-unit-to-bytes" title="convert a code unit to bytes">converted to bytes</a> using
 <a href="#utf-16be-flag">utf-16be flag</a>.

 <li><p>Return a byte sequence of <var>lead</var> followed by <var>trail</var>.
</ol>


<h3 id="utf-16be"><span class="secno">14.3 </span><dfn>utf-16be</dfn></h3>

<h4 id="utf-16be-decoder"><span class="secno">14.3.1 </span><dfn>utf-16be decoder</dfn></h4>

<p><a href="#utf-16be">utf-16be</a>'s <a href="#decoder">decoder</a> is <a href="#shared-utf-16-decoder">shared utf-16 decoder</a> with
its <a href="#utf-16be-flag">utf-16be flag</a> set.


<h4 id="utf-16be-encoder"><span class="secno">14.3.2 </span><dfn>utf-16be encoder</dfn></h4>

<p><a href="#utf-16be">utf-16be</a>'s <a href="#encoder">encoder</a> is <a href="#shared-utf-16-encoder">shared utf-16 encoder</a> with
its <a href="#utf-16be-flag">utf-16be flag</a> set.


<h3 id="utf-16le"><span class="secno">14.4 </span><dfn>utf-16le</dfn></h3>

<p class="note">In violation of the Unicode standard,
"<code title="">utf-16</code>" is a <a href="#label">label</a> for
<a href="#utf-16le">utf-16le</a> rather than its own standalone <a href="#encoding">encoding</a>.


<h4 id="utf-16le-decoder"><span class="secno">14.4.1 </span><dfn>utf-16le decoder</dfn></h4>

<p><a href="#utf-16le">utf-16le</a>'s <a href="#decoder">decoder</a> is <a href="#shared-utf-16-decoder">shared utf-16 decoder</a> with
its <a href="#utf-16be-flag">utf-16be flag</a> unset.


<h4 id="utf-16le-encoder"><span class="secno">14.4.2 </span><dfn>utf-16le encoder</dfn></h4>

<p><a href="#utf-16le">utf-16le</a>'s <a href="#encoder">encoder</a> is <a href="#shared-utf-16-encoder">shared utf-16 encoder</a> with
its <a href="#utf-16be-flag">utf-16be flag</a> unset.


<h3 id="x-user-defined"><span class="secno">14.5 </span><dfn>x-user-defined</dfn></h3>

<p class="note">While technically this is a <a href="#single-byte-encoding">single-byte encoding</a>,
it is defined separately as it can be implemented algorithmically.

<!--
This encoding is silly, however, the web depends on it:

http://krijnhoetmer.nl/irc-logs/whatwg/20121003#l-461
http://krijnhoetmer.nl/irc-logs/whatwg/20121010#l-812

http://stackoverflow.com/questions/6986789/why-are-some-bytes-prefixed-with-0xf7-when-using-charset-x-user-defined-with-xm
-->

<h4 id="x-user-defined-decoder"><span class="secno">14.5.1 </span><dfn>x-user-defined decoder</dfn></h4>

<p><a href="#x-user-defined">x-user-defined</a>'s <a href="#decoder">decoder</a>'s <a href="#handler">handler</a>, given a
<var>stream</var> and <var title="">byte</var>, runs these steps:

<ol>
 <li><p>If <var title="">byte</var> is <a href="#end-of-stream">end-of-stream</a>, return
 <a href="#finished">finished</a>.

 <li><p>If <var title="">byte</var> is in the range 0x00 to 0x7F, return
 a code point whose value is <var title="">byte</var>.

 <li><p>Return a code point whose value is 0xF780 + <var title="">byte</var> âˆ’ 0x80.
</ol>


<h4 id="x-user-defined-encoder"><span class="secno">14.5.2 </span><dfn>x-user-defined encoder</dfn></h4>

<p><a href="#x-user-defined">x-user-defined</a>'s <a href="#encoder">encoder</a>'s <a href="#handler">handler</a>, given a
<var>stream</var> and <var title="">code point</var>, runs these steps:

<ol>
 <li><p>If <var title="">code point</var> is <a href="#end-of-stream">end-of-stream</a>, return
 <a href="#finished">finished</a>.

 <li><p>If <var title="">code point</var> is in the range U+0000 to U+007F, return
 a byte whose value is <var title="">code point</var>.

 <li><p>If <var title="">code point</var> is in the range U+F780 to U+F7FF, return
 a byte whose value is <var title="">code point</var> âˆ’ 0xF780 + 0x80.

 <li><p>Return <a href="#error">error</a> with <var title="">code point</var>.
</ol>



<h2 class="no-num" id="references">References</h2>

<div id="anolis-references"><dl><dt id="refsDOM">[DOM]
<dd><cite><a href="http://dom.spec.whatwg.org/">DOM</a></cite>, Anne van Kesteren, Aryeh Gregor and Ms2ger. WHATWG.

<dt id="refsHTML">[HTML]
<dd>(Non-normative) <cite><a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/">HTML</a></cite>, Ian Hickson. WHATWG.

<dt id="refsRFC2119">[RFC2119]
<dd><cite><a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a></cite>, Scott Bradner. IETF.

<dt id="refsTYPEDARRAY">[TYPEDARRAY]
<dd><cite><a href="http://www.khronos.org/registry/typedarray/specs/latest/">Typed Array</a></cite>, David Herman and Kenneth Russell. Khronos.

<dt id="refsUNICODE">[UNICODE]
<dd><cite><a href="http://www.unicode.org/versions/latest/">Unicode Standard</a></cite>. Unicode Consortium.

<dt id="refsURL">[URL]
<dd>(Non-normative) <cite><a href="http://url.spec.whatwg.org/">URL</a></cite>, Anne van Kesteren. WHATWG.

<dt id="refsWEBIDL">[WEBIDL]
<dd><cite><a href="http://heycam.github.io/webidl/">Web IDL</a></cite>, Cameron McCormack. W3C.

<dt id="refsXML">[XML]
<dd>(Non-normative) <cite><a href="http://www.w3.org/TR/xml/">Extensible Markup Language</a></cite>, Tim Bray, Jean Paoli, C. M. Sperberg-McQueen et al.. W3C.

</dl></div>



<h2 class="no-num" id="acknowledgments">Acknowledgments</h2>

<p>There have been a lot of people that have helped make encodings more
interoperable over the years and thereby furthered the goals of this
standard. Likewise many people have helped making this standard what it is
today.

<p>Ideally they are all listed here so please contact the editor with any
omissions.

<p>With that, many thanks to

Alan Chaney,
Allen Wirfs-Brock,
Ben Noordhuis,
Boris Zbarsky,
Cameron McCormack,
Charles McCathieNeville,
David Carlisle,
Doug Ewell,
Erik van der Poel,
è­šæ°¸é‹’ (Frank Yung-Fong Tang),
Geoffrey Sneddon,
Glenn Maynard,
Gordon P. Hemsley,
Henri Sivonen,
Ian Hickson,
James Graham,
John Tamplin,
Joshua Bell,
ì‹ ì •ì‹ (Jungshik Shin),
å·å¹¡å¤ªä¸€ (Kawabata Taichi),
Ken Lunde,
Kenneth Russell,
Leif Halvard Silli,
Makoto Kato,
Mark Callow,
Mark Davis,
Martin DÃ¼rst,
Masatoshi Kimura,
Ms2ger,
Nigel Tao,
Norbert Lindenberg,
Ã˜istein E. Andersen,
Peter Krefting,
Philip JÃ¤genstedt,
Philip Taylor,
Robbert Broersma,
Robert Mustacchi,
Ryan Dahl,
Shawn Steele,
Simon Montagu,
Simon Pieters,
Simon Sapin,
Vyacheslav Matva, and
æˆç€¬ã‚†ã„ (Yui Naruse)

for being awesome.

<script id="head" src="//www.whatwg.org/specs/web-apps/current-work/dfn.js"></script>
